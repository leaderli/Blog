"use strict";
var fs = require("fs");

hexo.on("generateAfter", function (post) {
    var path = hexo.config.li.path;
    if (path.length < 1) {
        return;
    }
    var source_img_path = path + "source/_posts/images/";
    var target_img_path = path + "public/images/";

    if (!fs.existsSync(target_img_path)) {
        console.log("mkdir " + target_img_path);
        fs.mkdirSync(target_img_path, { recursive: true });
    }

    let paths = fs.readdirSync(source_img_path);
    paths.forEach(function (path) {
        if (path.startsWith(".")) {
            return;
        }
        var _src = source_img_path + path;
        var _tar = target_img_path + path;
        if (fs.existsSync(_tar)) {
            return;
        }
        fs.copyFileSync(_src, _tar, fs.constants.COPYFILE_EXCL);
    });
});