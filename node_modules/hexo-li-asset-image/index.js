"use strict";
var cheerio = require("cheerio");

hexo.extend.filter.register("after_post_render", function (data) {
    var path = hexo.config.li.path; //_config.yml中新增配置
    if (path.length < 1) {
        return;
    }

    var toprocess = ["excerpt", "more", "content"];
    for (var i = 0; i < toprocess.length; i++) {
        var key = toprocess[i];
        var $ = cheerio.load(data[key], {
            ignoreWhitespace: false,
            xmlMode: false,
            lowerCaseTags: false,
            decodeEntities: false,
        });
        $("img").each(function () {
            if ($(this).attr("src")) {
                var src = $(this).attr("src").replace("\\", "/");
                if (src.startsWith("./images/")) {
                    src = src.substring(1);
                    $(this).attr("src", src);
                }
            }
        });
        data[key] = $.html();
    }
})
