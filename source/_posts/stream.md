---
title: stream
date: 2020-12-16 13:32:09
categories: java
tags:
  - reactor
  - stream
---

参考[Stream 流水线原理](https://www.jianshu.com/p/893fb6febc70)，我们尝试模仿写一个简单的，能说明其基本工作原理的。

我们将 Stream 的执行过程定义为一个个操作节点，那么一般情况下，Stream 的执行过程主要分为以下部分

1. 源节点
2. 中间操作节点
3. 终止操作节点

通常我们会将多个操作构建成作用链， 将每个元素依次让作用链进行处理 ，终止操作收集作用链处理的结果

我们需要实现以下几个特征

1. 要实现链式调用，那么需要定义一个 Stream 的接口来声明所有操作的方法，并且接口的方法的返回值也是 Stream
2. 要实现作用链，那么需要定义一个链表，将操作串联起来。在 Stream 中的链式调用方法中，需要将当前操作添加到这个链表尾部。
3. 仅当调用终止操作节点时，才可能开始对每个元素依次执行作用链，那么我们首先需要找到链表的头
4. 一般情况下，数据是基于某种泛型的，所以操作链表肯定也是基于泛型的，但是有些函数类似`mapper`，操作前后的泛型可能会发生变换，这就要求这个链表出入参的泛型可不同
