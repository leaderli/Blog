<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">



















  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  

  
    
      
    

    
  

  
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext">
  






<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/css/main.css?v=7.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="与其感慨路难行，不如马上就出发">
<meta property="og:type" content="website">
<meta property="og:title" content="大狗哥传奇">
<meta property="og:url" content="https://leaderli.github.io/page/4/index.html">
<meta property="og:site_name" content="大狗哥传奇">
<meta property="og:description" content="与其感慨路难行，不如马上就出发">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="大狗哥传奇">
<meta name="twitter:description" content="与其感慨路难行，不如马上就出发">





  
  
  <link rel="canonical" href="https://leaderli.github.io/page/4/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>大狗哥传奇</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">大狗哥传奇</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
  <script type="text/javascript">
     var search_path = "<%= config.search.path %>";
     if (search_path.length == 0) {
     	search_path = "search.json";
     }
     var path = "<%= config.root %>" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
 </script>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://leaderli.github.io/2019/08/06/java-tips/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lijun">
      <meta itemprop="description" content="与其感慨路难行，不如马上就出发">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大狗哥传奇">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/08/06/java-tips/" class="post-title-link" itemprop="url">java tips</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-08-06 10:50:37" itemprop="dateCreated datePublished" datetime="2019-08-06T10:50:37+08:00">2019-08-06</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-11-12 00:27:28" itemprop="dateModified" datetime="2019-11-12T00:27:28+08:00">2019-11-12</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x63A7;&#x5236;&#x53F0;<code>console</code>&#x4E71;&#x7801;</p>
<p><code>java</code>&#x542F;&#x52A8;&#x53C2;&#x6570;&#x6DFB;&#x52A0; <code>-Dfile.encoding=utf-8</code></p>
<p>&#x5C06;&#x5E38;&#x91CF;&#x653E;&#x5728;&#x63A5;&#x53E3;&#x4E2D;&#xFF0C;&#x901A;&#x8FC7;&#x7EE7;&#x627F;&#x8BE5;&#x63A5;&#x53E3;&#xFF0C;&#x8C03;&#x7528;&#x5E38;&#x91CF;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ClassConstants</span></span>{</span><br><span class="line">   <span class="keyword">int</span> CONSUMER = <span class="number">1</span>;<span class="comment">//&#x63A5;&#x53E3;&#x4E2D;&#x53D8;&#x91CF;&#x9ED8;&#x8BA4;&#x4E3A; static final</span></span><br><span class="line">   <span class="keyword">int</span> DISPLAY = <span class="number">2</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x67E5;&#x770B; Class &#x662F;&#x5426;&#x662F;&#x57FA;&#x672C;&#x7C7B;&#x578B;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clasz.isPrimitive();</span><br></pre></td></tr></table></figure>
<p>&#x67E5;&#x770B;&#x7C7B;&#x662F;&#x5426;&#x4E3A;&#x57FA;&#x672C;&#x7C7B;&#x578B;&#x6216;&#x5305;&#x88C5;&#x7C7B;&#x578B;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.ClassUtils;</span><br><span class="line">ClassUtils.isPrimitiveOrWrapper(klass)</span><br></pre></td></tr></table></figure>
<p>&#x8BFB;&#x53D6; properties &#x4E2D;&#x6587;&#x4E71;&#x7801;&#x89E3;&#x51B3;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">properties.load(<span class="keyword">new</span> InputStreamReader(AutoConfig.class.getResourceAsStream(<span class="string">&quot;/application.properties&quot;</span>),<span class="string">&quot;utf-8&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>&#x5224;&#x65AD;&#x7C7B;&#x662F;&#x5426;&#x4E3A;&#x6570;&#x7EC4;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">klass.isArray();</span><br></pre></td></tr></table></figure>
<p>&#x5224;&#x65AD;&#x7C7B;&#x662F;&#x5426;&#x7EE7;&#x627F;&#x81EA;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Father.class.isAssignableFrom(Son.class)</span><br></pre></td></tr></table></figure>
<p>&#x6D41;&#x5FEB;&#x901F;&#x5220;&#x9664;,<code>Collection</code>&#x63D0;&#x4F9B;&#x4E86;&#x65B9;&#x6CD5;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Collection.removeIf(Predicate&lt;? <span class="keyword">super</span> E&gt; filter)</span><br></pre></td></tr></table></figure>
<p>&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x6267;&#x884C;&#x7684;&#x65B9;&#x6CD5;&#x540D;,&#x901A;&#x8FC7;&#x65B9;&#x6CD5;&#x5185;&#x7684;&#x5185;&#x90E8;&#x7C7B;&#x6765;&#x5B9E;&#x73B0;&#x7684;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Object(){}.getClass().getEnclosingMethod().getName();</span><br></pre></td></tr></table></figure>
<p>&#x8BBE;&#x7F6E;<code>SAXReader</code>&#x7684;<code>feature</code>&#x5C5E;&#x6027;&#xFF0C;&#x7981;&#x6B62;&#x6821;&#x9A8C;<code>dtd</code>&#x6587;&#x4EF6;,&#x8BFB;&#x53D6;<code>String</code>&#x4E3A;<code>DOMDocument</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xerces.internal.impl.Constants;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &#x5728;&#x8BFB;&#x53D6;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x53BB;&#x6389;dtd&#x7684;&#x9A8C;&#x8BC1;&#xFF0C;&#x53EF;&#x4EE5;&#x7F29;&#x77ED;&#x8FD0;&#x884C;&#x65F6;&#x95F4;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SAXReader <span class="title">getSAXReader</span><span class="params">()</span></span>{</span><br><span class="line">    SAXReader saxReader = <span class="keyword">new</span> SAXReader(DOMDocumentFactory.getInstance(),<span class="keyword">false</span>);</span><br><span class="line">     <span class="keyword">try</span> {</span><br><span class="line">         saxReader.setFeature(Constants.XERCES_FEATURE_PREFIX + Constants.LOAD_EXTERNAL_DTD_FEATURE, <span class="keyword">false</span>);  <span class="comment">//&#x8BBE;&#x7F6E;&#x4E0D;&#x9700;&#x8981;&#x6821;&#x9A8C;&#x5934;&#x6587;&#x4EF6;</span></span><br><span class="line">     } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">     }</span><br><span class="line">     <span class="keyword">return</span> saxReader;</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line">String xml = <span class="string">&quot;...xml...&quot;</span>;</span><br><span class="line">DOMDocument document = (DOMDocument) getSAXReader().read(<span class="keyword">new</span> StringReader(xml));</span><br></pre></td></tr></table></figure>
<p>&#x5207;&#x5272;&#x5B57;&#x7B26;&#x4E32;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String value = <span class="string">&quot;Notice:4001&quot;</span>;</span><br><span class="line">StringTokenizer st = <span class="keyword">new</span> StringTokenizer(value, <span class="string">&quot;:&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(st.hasMoreElements()){</span><br><span class="line">  System.out.println(st.nextToken());</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><code>String</code> &#x66FF;&#x6362; &#x6B63;&#x5219;&#x5339;&#x914D;&#x7EC4;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String s = <span class="string">&quot;HelloWorldMyNameIsCarl&quot;</span>.replaceAll(<span class="string">&quot;(.)([A-Z])&quot;</span>, <span class="string">&quot;$1_$2&quot;</span>);</span><br><span class="line">String s = <span class="string">&quot;1.1&quot;</span>.replaceAll(<span class="string">&quot;(\\.\\d)$&quot;</span>, <span class="string">&quot;$10&quot;</span>);<span class="comment">//$1&#x8868;&#x793A;&#x524D;&#x9762;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x7EC4;1&#x6240;&#x6355;&#x83B7;&#x5230;&#x7684;&#x5B57;&#x7B26;</span></span><br></pre></td></tr></table></figure>
<p><code>Spring</code>&#x6CE8;&#x5165;&#x6587;&#x4EF6;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.core.io.Resource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">&quot;classpath:rootxml.js&quot;</span>)</span><br><span class="line"><span class="keyword">private</span> Resource cert;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> ScriptException, IOException </span>{</span><br><span class="line">   System.out.println(StreamUtils.copyToString(cert.getInputStream(), StandardCharsets.UTF_8));</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><code>@Autowired(required = false)</code>&#x82E5;<code>Spring</code>&#x5BB9;&#x5668;&#x4E2D;&#x6CA1;&#x6709;&#x5BF9;&#x5E94;&#x7684;<code>BeanDefinition</code>&#x65F6;&#x4E0D;&#x4F1A;&#x6CE8;&#x5165;&#x503C;&#xFF0C;&#x53EF;&#x8D4B;&#x503C;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x503C;&#x907F;&#x514D;&#x7A7A;&#x6307;&#x9488;&#x7684;&#x60C5;&#x51B5;&#x3002;</p>
<p><code>Spring</code>&#x7684;<code>@Scheduled</code>&#xA0; &#x53EF;&#x4F7F;&#x7528;<code>crontab</code>&#x8BED;&#x6CD5;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x540C;&#x4E8E;<code>unix</code>&#x7684;&#x6807;&#x51C6;&#x8BED;&#x6CD5;&#xFF0C;&#x5B83;&#x7B2C;&#x4E00;&#x4F4D;&#x662F;&#x79D2;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scheduled</span>(cron = <span class="string">&quot;1 22 22 * * *&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">()</span> </span>{</span><br><span class="line">    logger.info(<span class="string">&quot;--------------------&quot;</span> + index++);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><code>cron</code>&#x89C4;&#x5219;&#x4E00;&#x5B9A;&#x662F; 6 &#x4F4D;&#x4EE5;&#x7A7A;&#x767D;&#x5B57;&#x7B26;&#x95F4;&#x9694;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5176;&#x4E2D;&#x6BCF;&#x4F4D;&#x4EE3;&#x8868;&#x7684;&#x542B;&#x4E49;&#x5982;&#x4E0B;</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x79D2;     &#x5206;   &#x5C0F;&#x65F6;    &#x65E5;    &#x6708;    &#x661F;&#x671F;</span><br><span class="line">0-59 0-59  0-23  1-31  1-12  0-6</span><br><span class="line"></span><br><span class="line">&#x8BB0;&#x4F4F;&#x51E0;&#x4E2A;&#x7279;&#x6B8A;&#x7B26;&#x53F7;&#x7684;&#x542B;&#x4E49;:</span><br><span class="line">*  &#x4EE3;&#x8868;&#x53D6;&#x503C;&#x8303;&#x56F4;&#x5185;&#x7684;&#x6570;&#x5B57;</span><br><span class="line">*/x  &#x4EE3;&#x8868;&#x6BCF;x</span><br><span class="line">x-y  &#x4EE3;&#x8868;&#x4ECE;x&#x5230;y</span><br><span class="line">,  &#x5206;&#x5F00;&#x51E0;&#x4E2A;&#x79BB;&#x6563;&#x7684;&#x6570;&#x5B57;</span><br></pre></td></tr></table></figure>
<p>&#x4F7F;&#x7528; shell</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x7CFB;&#x7EDF;&#x540D;&#x79F0;&#xFF0C;&#x53EF;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x547D;&#x4EE4;</span></span><br><span class="line">String os = System.getProperty(<span class="string">&quot;os.name&quot;</span>);</span><br><span class="line"><span class="comment">//&#x547D;&#x4EE4;&#x884C;&#x7684;&#x53C2;&#x6570;</span></span><br><span class="line">String [] para = <span class="keyword">new</span> String[]{<span class="string">&quot;-l&quot;</span>}</span><br><span class="line"><span class="comment">//&#x6267;&#x884C;&#x547D;&#x4EE4;</span></span><br><span class="line">Process ls = Runtime.getRuntime().exec(<span class="string">&quot;ls&quot;</span>,para, <span class="keyword">new</span> File(<span class="string">&quot;/Users/li/Downloads&quot;</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x83B7;&#x53D6;&#x547D;&#x4EE4;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x7684;inputstream&#x6D41;</span></span><br><span class="line">String getLs = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(ls.getInputStream())).lines().collect(Collectors.joining(System.lineSeparator()));</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x5728;&#x76EE;&#x5F55;&#x4E0B;&#x6267;&#x884C;&#x5177;&#x4F53;&#x7684;&#x547D;&#x4EE4;</span></span><br><span class="line"><span class="comment">//&#x56E0;&#x4E3A;java&#x6267;&#x884C;shell&#x65E0;&#x6CD5;&#x8FDB;&#x884C;&#x8FDE;&#x7EED;&#x6027;&#x7684;&#x4EA4;&#x4E92;&#x547D;&#x4EE4;&#xFF0C;&#x901A;&#x8FC7;&#x5C01;&#x88C5;&#x7684;bash&#x6216;&#x8005;python&#x811A;&#x672C;&#x6267;&#x884C;&#x4E00;&#x7CFB;&#x5217;&#x547D;&#x4EE4;&#x662F;&#x6BD4;&#x8F83;&#x597D;&#x7684;&#x9009;&#x62E9;</span></span><br><span class="line">Process process = Runtime.getRuntime().exec(<span class="string">&quot;python test.py&quot;</span>, <span class="keyword">null</span>, <span class="keyword">new</span> File(<span class="string">&quot;/Users/li/Downloads&quot;</span>));</span><br><span class="line"><span class="comment">// &#x90E8;&#x5206;os&#x9700;&#x8981;&#x5148;&#x8F93;&#x51FA;outputStream&#x6D41;&#xFF0C;&#x624D;&#x80FD;&#x6B63;&#x786E;&#x53D6;&#x5F97;shell&#x6267;&#x884C;&#x7ED3;&#x679C;</span></span><br><span class="line">Outputstream out = process.getOutputStream();</span><br><span class="line">out.flush();</span><br><span class="line">out.close();</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x4F7F;&#x7528;&#x6784;&#x9020;&#x5668;&#x6A21;&#x5F0F;</span></span><br><span class="line">ProcessBuilder builder = <span class="keyword">new</span> ProcessBuilder();</span><br><span class="line">builder.command(<span class="string">&quot;more&quot;</span>,<span class="string">&quot;test.py&quot;</span>);</span><br><span class="line">builder.directory(<span class="keyword">new</span> File(<span class="string">&quot;/Users/li/Downloads&quot;</span>));</span><br><span class="line"><span class="comment">//&#x91CD;&#x5B9A;&#x5411;&#x9519;&#x8BEF;&#x6D41;&#xFF0C;&#x5373;System.Err</span></span><br><span class="line">builder.redirectErrorStream(<span class="keyword">true</span>);</span><br><span class="line">Process process = builder.start();</span><br></pre></td></tr></table></figure>
<p>&#x83B7;&#x53D6;<code>tomcat</code>&#x8FD0;&#x884C;&#x7AEF;&#x53E3;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&#x901A;&#x8FC7;classpath&#x5B9A;&#x4F4D;tomcat&#x914D;&#x7F6E;&#x6587;&#x4EF6;conf/server.xml&#xFF0C;&#x4F7F;&#x7528;xpath&#x53BB;&#x89E3;&#x6790;</span></span><br><span class="line">File serverXml = <span class="keyword">new</span> File(<span class="string">&quot;/Users/li/java/apache-tomcat-7.0.70/conf/server.xml&quot;</span>);</span><br><span class="line">DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();</span><br><span class="line">domFactory.setNamespaceAware(<span class="keyword">true</span>); <span class="comment">// never forget this!</span></span><br><span class="line">DocumentBuilder builder = domFactory.newDocumentBuilder();</span><br><span class="line">Document doc = builder.parse(serverXml);</span><br><span class="line">XPathFactory factory = XPathFactory.newInstance();</span><br><span class="line">XPath xpath = factory.newXPath();</span><br><span class="line">XPathExpression expr = xpath.compile(<span class="string">&quot;/Server/Service[@name=&apos;Catalina&apos;]/Connector[starts-with(@protocol,&apos;HTTP&apos;)]/@port[1]&quot;</span>);</span><br><span class="line">String result = (String) expr.evaluate(doc, XPathConstants.STRING);</span><br><span class="line">port = result != <span class="keyword">null</span> &amp;&amp; result.length() &gt; <span class="number">0</span> ? Integer.valueOf(result) : <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>
<h2 id="tomcat&#x4F7F;&#x7528;java&#x542F;&#x52A8;&#x53D8;&#x91CF;&#x4F5C;&#x4E3A;&#x7AEF;&#x53E3;"><code>tomcat</code>&#x4F7F;&#x7528;<code>java</code>&#x542F;&#x52A8;&#x53D8;&#x91CF;&#x4F5C;&#x4E3A;&#x7AEF;&#x53E3;</h2>
<p>tomcat &#x9ED8;&#x8BA4;&#x4F1A;&#x52A0;&#x8F7D;<code>bin</code>&#x76EE;&#x5F55;&#x4E0B;&#x65B0;&#x5EFA;<code>setenv.sh</code>&#x4F5C;&#x4E3A;&#x542F;&#x52A8;&#x73AF;&#x5883;&#xFF0C;&#x82E5;&#x65E0;&#x5219;&#x65B0;&#x5EFA;&#x5373;&#x53EF;</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash">JAVA-OPTIONS</span></span><br><span class="line"></span><br><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -Dtomcat.port=9999&quot;</span><br></pre></td></tr></table></figure>
<p><code>tomcat</code>&#x7684;&#x7AEF;&#x53E3;&#x914D;&#x7F6E;&#x6587;&#x4EF6;<code>conf/server.xml</code>&#x4E2D;&#xFF0C;&#x5C06;&#x9ED8;&#x8BA4;&#x7AEF;&#x53E3;&#x66FF;&#x6362;&#x4E3A;&#x5982;&#x4E0B;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">Service</span> <span class="attr">name</span>=<span class="string">&quot;Catalina&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;{tomcat.port}&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;HTTP/1.1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">...</span></span></span><br></pre></td></tr></table></figure>
<h2 id="stream-&#x4E00;&#x4E9B;&#x65B9;&#x6CD5;">stream &#x4E00;&#x4E9B;&#x65B9;&#x6CD5;</h2>
<p><code>reduce</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">String join= numbers.stream().map(String::valueOf).reduce((total, element) -&gt; total + element+<span class="string">&quot;&quot;</span>).get();</span><br><span class="line">System.out.println(<span class="string">&quot;join= &quot;</span> + join);</span><br></pre></td></tr></table></figure>
<p><code>groupingBy</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> List&lt;String&gt; items =</span><br><span class="line">            Arrays.asList(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>,</span><br><span class="line">                <span class="string">&quot;apple&quot;</span>, <span class="string">&quot;orange&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;papaya&quot;</span>);</span><br><span class="line">Map&lt;String, Long&gt; result =</span><br><span class="line">    items.stream().collect(</span><br><span class="line">        Collectors.groupingBy(</span><br><span class="line">            Function.identity(), Collectors.counting()</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">System.out.println(<span class="string">&quot;result = &quot;</span> + result);</span><br><span class="line">Map&lt;Object, Set&lt;String&gt;&gt; collect = items.stream().collect(Collectors.groupingBy(String::length, Collectors.mapping(e -&gt; e,</span><br><span class="line">    Collectors.toSet())));</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;collect = &quot;</span> + collect);</span><br></pre></td></tr></table></figure>
<p><code>join</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String join = items.stream().collect(Collectors.joining(<span class="string">&quot;,&quot;</span>));</span><br></pre></td></tr></table></figure>
<h2 id="eventbus">EventBus</h2>
<p><code>maven</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.guava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guava<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>21.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>post</code>&#x4E8B;&#x4EF6;&#xFF0C;&#x6CE8;&#x518C;&#x7684; listener &#x4E2D;&#x6CE8;&#x89E3;&#x4E86;<code>@Subscribe</code>&#x7684;&#x65B9;&#x6CD5;&#x4F1A;&#x88AB;&#x6267;&#x884C;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x7684;&#x53C2;&#x6570;&#x7684;&#x7C7B;&#x578B;&#x9700;&#x8981;&#x4E0E;<code>event</code>&#x7C7B;&#x578B;&#x4E00;&#x81F4;&#xFF0C;&#x82E5;&#x6CA1;&#x6709;&#x7C7B;&#x578B;&#x4E00;&#x81F4;&#x7684;<code>@Subscribe</code>&#xFF0C;&#x5219;&#x7531;&#x53C2;&#x6570;&#x7C7B;&#x578B;<code>DeadEvent</code>&#x7684;<code>listener</code>&#x7EDF;&#x4E00;&#x5904;&#x7406;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventBusTest</span> </span>{</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>{</span><br><span class="line">        EventBus eventBus = <span class="keyword">new</span> EventBus();</span><br><span class="line">        EventListener eventListener = <span class="keyword">new</span> EventListener();</span><br><span class="line">        eventBus.register(eventListener);</span><br><span class="line">        eventBus.post(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        eventBus.post(<span class="number">123</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EventListener</span> </span>{</span><br><span class="line">        <span class="meta">@Subscribe</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stringEvent</span><span class="params">(String event)</span> </span>{</span><br><span class="line">            System.out.println(<span class="string">&quot;event = &quot;</span> + event);</span><br><span class="line">        }</span><br><span class="line">        <span class="meta">@Subscribe</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDeadEvent</span><span class="params">(DeadEvent deadEvent)</span> </span>{</span><br><span class="line">            System.out.println(<span class="string">&quot;deadEvent = &quot;</span> + deadEvent);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h2 id="dom4j&#x76F4;&#x63A5;&#x83B7;&#x53D6;&#x503C;"><code>dom4j</code>&#x76F4;&#x63A5;&#x83B7;&#x53D6;&#x503C;</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(doc.selectObject(<span class="string">&quot;substring(/root/name/text(),2)&quot;</span>));</span><br></pre></td></tr></table></figure>
<h2 id="junit-&#x65AD;&#x8A00;&#x5F02;&#x5E38;"><code>junit</code> &#x65AD;&#x8A00;&#x5F02;&#x5E38;</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canVote</span><span class="params">(<span class="keyword">int</span> age)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (i&lt;=<span class="number">0</span>) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;age should be +ve&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (i&lt;<span class="number">18</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestStudent</span></span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Rule</span></span><br><span class="line">    <span class="keyword">public</span> ExpectedException thrown= ExpectedException.none();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">canVote_throws_IllegalArgumentException_for_zero_age</span><span class="params">()</span> </span>{</span><br><span class="line">        Student student = <span class="keyword">new</span> Student();</span><br><span class="line">        thrown.expect(IllegalArgumentException.class);</span><br><span class="line">        thrown.expectMessage(<span class="string">&quot;age should be +ve&quot;</span>);</span><br><span class="line">        student.canVote(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h2 id="&#x57FA;&#x672C;&#x7C7B;&#x578B;&#x96F6;&#x503C;">&#x57FA;&#x672C;&#x7C7B;&#x578B;&#x96F6;&#x503C;</h2>
<p>&#x5BF9;&#x57FA;&#x672C;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x6765;&#x8BF4;&#xFF0C;&#x5BF9;&#x4E8E;&#x7C7B;&#x53D8;&#x91CF;<code>static</code>&#x548C;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x663E;&#x5F0F;&#x5730;&#x5BF9;&#x5176;&#x8D4B;&#x503C;&#x800C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#xFF0C;&#x5219;&#x7CFB;&#x7EDF;&#x4F1A;&#x4E3A;&#x5176;&#x8D4B;&#x4E88;&#x9ED8;&#x8BA4;&#x7684;&#x96F6;&#x503C;&#xFF0C;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x8FD9;&#x4E2A;&#x7279;&#x6027;&#xFF0C;&#x76F4;&#x63A5;&#x7528;&#x9759;&#x6001;&#x7C7B;&#x5E38;&#x91CF;&#x6765;&#x83B7;&#x53D6;&#x57FA;&#x672C;&#x53D8;&#x91CF;&#x7684;&#x521D;&#x59CB;&#x503C;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Primitive</span> </span>{</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> i; <span class="comment">//&#x9ED8;&#x8BA4;&#x503C;0</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">char</span> c; <span class="comment">//&#x9ED8;&#x8BA4;&#x503C;&apos;\u0000&apos;</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://leaderli.github.io/2019/08/05/Spring自定义ReturnValueHandlers/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lijun">
      <meta itemprop="description" content="与其感慨路难行，不如马上就出发">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大狗哥传奇">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/08/05/Spring自定义ReturnValueHandlers/" class="post-title-link" itemprop="url">Spring自定义ReturnValueHandlers</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-08-05 21:38:39" itemprop="dateCreated datePublished" datetime="2019-08-05T21:38:39+08:00">2019-08-05</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-11-13 02:07:32" itemprop="dateModified" datetime="2019-11-13T02:07:32+08:00">2019-11-13</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/springboot/" itemprop="url" rel="index"><span itemprop="name">springboot</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="&#x7248;&#x672C;&#x8BF4;&#x660E;">&#x7248;&#x672C;&#x8BF4;&#x660E;</h2>
<p><code>jdk</code>:1.8.0_131<br>
<code>springboot</code>:2.1.6.RELEAS<br>
<code>maven</code>:3.6.1<br>
<code>database</code>:mysql-5.7.14<br>
<code>lombok&#x63D2;&#x4EF6;</code></p>
<h2 id="&#x6E90;&#x7801;&#x5206;&#x6790;">&#x6E90;&#x7801;&#x5206;&#x6790;</h2>
<p>&#x7701;&#x7565;&#x6784;&#x5EFA;&#x9879;&#x76EE;&#xFF0C;junit &#x6D4B;&#x8BD5;&#x7B49;&#x6B65;&#x9AA4;&#xFF0C;&#x53EA;&#x5206;&#x6790;&#x4EE3;&#x7801;&#x4E0E;&#x5B9E;&#x73B0;&#x3002; &#x6839;&#x636E;<a href="/2019/08/04/spring&#x9759;&#x6001;&#x8D44;&#x6E90;&#x52A0;&#x8F7D;&#x6E90;&#x7801;&#x6D45;&#x6790;/" title="spring&#x9759;&#x6001;&#x8D44;&#x6E90;&#x52A0;&#x8F7D;&#x6E90;&#x7801;&#x6D45;&#x6790;">spring&#x9759;&#x6001;&#x8D44;&#x6E90;&#x52A0;&#x8F7D;&#x6E90;&#x7801;&#x6D45;&#x6790;</a>&#x4E2D;&#x7684;&#x5206;&#x6790;,&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x77E5;&#x9053; <code>DispatcherServlet</code>&#x4F1A;&#x62E6;&#x622A;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#xFF0C;&#x5BFB;&#x627E;&#x5408;&#x9002;&#x7684;<code>mappedHandler</code>&#x53BB;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#xFF0C;&#x5E76;&#x6839;&#x636E;<code>mappedHandler</code>&#x53BB;&#x627E;&#x5BF9;&#x5E94;&#x7684;&#x9002;&#x914D;&#x5668;<code>HandlerAdapter</code>&#x6765;&#x5B9E;&#x9645;&#x8BF7;&#x6C42;<code>controller</code>&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x9488;&#x5BF9;&#x63A5;&#x53E3;&#x6765;&#x8BF4;&#x4E00;&#x822C;&#x4F7F;&#x7528;&#x7684;&#x662F;<code>RequestMappingHandlerAdapter</code></p>
<p>&#x5177;&#x4F53;&#x8C03;&#x7528;<code>controller</code>&#x65B9;&#x6CD5;&#x7684;&#x7EC6;&#x8282;&#x6211;&#x4EEC;&#x4E0D;&#x9700;&#x8981;&#x5173;&#x6CE8;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4EC5;&#x4EC5;&#x5173;&#x6CE8;<code>RequestMappingHandlerAdapter</code>&#x662F;&#x5982;&#x4F55;&#x5904;&#x7406;&#x65B9;&#x6CD5;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x7684;&#x3002; &#x8282;&#x9009;&#x90E8;&#x5206;<code>DispatcherServlet</code>&#x7684;<code>doDispatch</code>&#x65B9;&#x6CD5;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &#x6839;&#x636E;mappedHandler&#x67E5;&#x627E;&#x5408;&#x9002;&#x7684;&#x9002;&#x914D;&#x5668;</span></span><br><span class="line">HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());</span><br><span class="line"></span><br><span class="line"><span class="comment">// Process last-modified header, if supported by the handler.</span></span><br><span class="line">String method = request.getMethod();</span><br><span class="line"><span class="keyword">boolean</span> isGet = <span class="string">&quot;GET&quot;</span>.equals(method);</span><br><span class="line"><span class="keyword">if</span> (isGet || <span class="string">&quot;HEAD&quot;</span>.equals(method)) {</span><br><span class="line">    <span class="keyword">long</span> lastModified = ha.getLastModified(request, mappedHandler.getHandler());</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">new</span> ServletWebRequest(request, response).checkNotModified(lastModified) &amp;&amp; isGet) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!mappedHandler.applyPreHandle(processedRequest, response)) {</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x5B9E;&#x9645;&#x8C03;&#x7528;controller&#x65B9;&#x6CD5;&#x7684;&#x5730;&#x65B9;</span></span><br><span class="line">mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br></pre></td></tr></table></figure>
<p><code>RequestMappingHandlerAdapter</code>&#x7684;<code>handle</code>&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x4E86;&#x5185;&#x90E8;&#x7684;<code>handleInternal</code>&#x65B9;&#x6CD5;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> ModelAndView <span class="title">handleInternal</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">        HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line"></span><br><span class="line">    ModelAndView mav;</span><br><span class="line">    checkRequest(request);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Execute invokeHandlerMethod in synchronized block if required.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.synchronizeOnSession) {</span><br><span class="line">        HttpSession session = request.getSession(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">if</span> (session != <span class="keyword">null</span>) {</span><br><span class="line">            Object mutex = WebUtils.getSessionMutex(session);</span><br><span class="line">            <span class="keyword">synchronized</span> (mutex) {</span><br><span class="line">                mav = invokeHandlerMethod(request, response, handlerMethod);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">// No HttpSession available -&gt; no mutex necessary</span></span><br><span class="line">            mav = invokeHandlerMethod(request, response, handlerMethod);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">// No synchronization on session demanded at all...</span></span><br><span class="line">        mav = invokeHandlerMethod(request, response, handlerMethod);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!response.containsHeader(HEADER_CACHE_CONTROL)) {</span><br><span class="line">        <span class="keyword">if</span> (getSessionAttributesHandler(handlerMethod).hasSessionAttributes()) {</span><br><span class="line">            applyCacheSeconds(response, <span class="keyword">this</span>.cacheSecondsForSessionAttributeHandlers);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> {</span><br><span class="line">            prepareResponse(response);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mav;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x518D;&#x67E5;&#x770B;<code>invokeHandlerMethod</code>&#x5B9E;&#x73B0;&#x7EC6;&#x8282;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> ModelAndView <span class="title">invokeHandlerMethod</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">        HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line"></span><br><span class="line">    ServletWebRequest webRequest = <span class="keyword">new</span> ServletWebRequest(request, response);</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        WebDataBinderFactory binderFactory = getDataBinderFactory(handlerMethod);</span><br><span class="line">        ModelFactory modelFactory = getModelFactory(handlerMethod, binderFactory);</span><br><span class="line"></span><br><span class="line">        ServletInvocableHandlerMethod invocableMethod = createInvocableHandlerMethod(handlerMethod);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.argumentResolvers != <span class="keyword">null</span>) {</span><br><span class="line">            invocableMethod.setHandlerMethodArgumentResolvers(<span class="keyword">this</span>.argumentResolvers);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x8981;&#x6CE8;&#x610F;&#x4E0B;&#xFF0C;&#x540E;&#x9762;&#x5B9E;&#x73B0;&#x7684;&#x81EA;&#x5B9A;&#x4E49;MyResponseType&#x6CE8;&#x89E3;&#x5C31;&#x548C;&#x8FD9;&#x91CC;&#x6709;&#x5173;</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.returnValueHandlers != <span class="keyword">null</span>) {</span><br><span class="line">            invocableMethod.setHandlerMethodReturnValueHandlers(<span class="keyword">this</span>.returnValueHandlers);</span><br><span class="line">        }</span><br><span class="line">        invocableMethod.setDataBinderFactory(binderFactory);</span><br><span class="line">        invocableMethod.setParameterNameDiscoverer(<span class="keyword">this</span>.parameterNameDiscoverer);</span><br><span class="line"></span><br><span class="line">        ModelAndViewContainer mavContainer = <span class="keyword">new</span> ModelAndViewContainer();</span><br><span class="line">        mavContainer.addAllAttributes(RequestContextUtils.getInputFlashMap(request));</span><br><span class="line">        modelFactory.initModel(webRequest, mavContainer, invocableMethod);</span><br><span class="line">        mavContainer.setIgnoreDefaultModelOnRedirect(<span class="keyword">this</span>.ignoreDefaultModelOnRedirect);</span><br><span class="line"></span><br><span class="line">        AsyncWebRequest asyncWebRequest = WebAsyncUtils.createAsyncWebRequest(request, response);</span><br><span class="line">        asyncWebRequest.setTimeout(<span class="keyword">this</span>.asyncRequestTimeout);</span><br><span class="line"></span><br><span class="line">        WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);</span><br><span class="line">        asyncManager.setTaskExecutor(<span class="keyword">this</span>.taskExecutor);</span><br><span class="line">        asyncManager.setAsyncWebRequest(asyncWebRequest);</span><br><span class="line">        asyncManager.registerCallableInterceptors(<span class="keyword">this</span>.callableInterceptors);</span><br><span class="line">        asyncManager.registerDeferredResultInterceptors(<span class="keyword">this</span>.deferredResultInterceptors);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (asyncManager.hasConcurrentResult()) {</span><br><span class="line">            Object result = asyncManager.getConcurrentResult();</span><br><span class="line">            mavContainer = (ModelAndViewContainer) asyncManager.getConcurrentResultContext()[<span class="number">0</span>];</span><br><span class="line">            asyncManager.clearConcurrentResult();</span><br><span class="line">            LogFormatUtils.traceDebug(logger, traceOn -&gt; {</span><br><span class="line">                String formatted = LogFormatUtils.formatValue(result, !traceOn);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Resume with async result [&quot;</span> + formatted + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">            });</span><br><span class="line">            invocableMethod = invocableMethod.wrapConcurrentResult(result);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//&#x5B9E;&#x9645;&#x8C03;&#x7528;&#x7684;&#x5730;&#x65B9;</span></span><br><span class="line">        invocableMethod.invokeAndHandle(webRequest, mavContainer);</span><br><span class="line">        <span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> getModelAndView(mavContainer, modelFactory, webRequest);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">finally</span> {</span><br><span class="line">        webRequest.requestCompleted();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x67E5;&#x770B;&#x4E0B;<code>invocableMethod.invokeAndHandle</code>&#x7684;&#x7EC6;&#x8282;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invokeAndHandle</span><span class="params">(ServletWebRequest webRequest, ModelAndViewContainer mavContainer,</span></span></span><br><span class="line"><span class="function"><span class="params">        Object... providedArgs)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line"></span><br><span class="line">    Object returnValue = invokeForRequest(webRequest, mavContainer, providedArgs);</span><br><span class="line">    setResponseStatus(webRequest);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (returnValue == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">if</span> (isRequestNotModified(webRequest) || getResponseStatus() != <span class="keyword">null</span> || mavContainer.isRequestHandled()) {</span><br><span class="line">            disableContentCachingIfNecessary(webRequest);</span><br><span class="line">            mavContainer.setRequestHandled(<span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.hasText(getResponseStatusReason())) {</span><br><span class="line">        mavContainer.setRequestHandled(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    mavContainer.setRequestHandled(<span class="keyword">false</span>);</span><br><span class="line">    Assert.state(<span class="keyword">this</span>.returnValueHandlers != <span class="keyword">null</span>, <span class="string">&quot;No return value handlers&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="comment">//&#x5904;&#x7406;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;</span></span><br><span class="line">        <span class="keyword">this</span>.returnValueHandlers.handleReturnValue(</span><br><span class="line">                returnValue, getReturnValueType(returnValue), mavContainer, webRequest);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">catch</span> (Exception ex) {</span><br><span class="line">        <span class="keyword">if</span> (logger.isTraceEnabled()) {</span><br><span class="line">            logger.trace(formatErrorForReturnValue(returnValue), ex);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">throw</span> ex;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><code>this.returnValueHandlers.handleReturnValue</code>&#x7684;&#x5B9E;&#x73B0;&#x7EC6;&#x8282;&#x7C7B;<code>HandlerMethodReturnValueHandlerComposite</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleReturnValue</span><span class="params">(@Nullable Object returnValue, MethodParameter returnType,</span></span></span><br><span class="line"><span class="function"><span class="params">        ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">    <span class="comment">//&#x67E5;&#x627E;&#x5408;&#x9002;&#x7684;&#x5904;&#x7406;&#x5668;</span></span><br><span class="line">    HandlerMethodReturnValueHandler handler = selectHandler(returnValue, returnType);</span><br><span class="line">    <span class="keyword">if</span> (handler == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Unknown return value type: &quot;</span> + returnType.getParameterType().getName());</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//&#x5904;&#x7406;&#x5668;&#x6267;&#x884C;</span></span><br><span class="line">    handler.handleReturnValue(returnValue, returnType, mavContainer, webRequest);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> HandlerMethodReturnValueHandler <span class="title">selectHandler</span><span class="params">(@Nullable Object value, MethodParameter returnType)</span> </span>{</span><br><span class="line">    <span class="keyword">boolean</span> isAsyncValue = isAsyncReturnValue(value, returnType);</span><br><span class="line">    <span class="comment">//&#x904D;&#x5386;&#x6240;&#x6709;&#x5904;&#x7406;&#x5668;&#xFF0C;&#x53EA;&#x8981;&#x627E;&#x5230;&#x5C31;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#xFF0C;&#x6240;&#x4EE5;&#x5F97;&#x8003;&#x8651;&#x4E0B;&#x4F18;&#x5148;&#x7EA7;&#x5173;&#x7CFB;</span></span><br><span class="line">    <span class="keyword">for</span> (HandlerMethodReturnValueHandler handler : <span class="keyword">this</span>.returnValueHandlers) {</span><br><span class="line">        <span class="keyword">if</span> (isAsyncValue &amp;&amp; !(handler <span class="keyword">instanceof</span> AsyncHandlerMethodReturnValueHandler)) {</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (handler.supportsReturnType(returnType)) {</span><br><span class="line">            <span class="keyword">return</span> handler;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x9ED8;&#x8BA4;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x5904;&#x7406;&#x5668;&#x6709;&#x4EE5;&#x4E0B;</p>
<figure>
<img src="/images/Spring&#x81EA;&#x5B9A;&#x4E49;ReturnValueHandlers_&#x8FD4;&#x56DE;&#x503C;&#x5904;&#x7406;&#x5668;.jpg" alt="&#x8FD4;&#x56DE;&#x503C;&#x5904;&#x7406;&#x5668;"><figcaption>&#x8FD4;&#x56DE;&#x503C;&#x5904;&#x7406;&#x5668;</figcaption>
</figure>
<p>&#x6211;&#x4EEC;&#x67E5;&#x770B;&#x4E0B;&#x5178;&#x578B;&#x7684;<code>@ResponseBody</code>&#x7684;&#x5904;&#x7406;&#x5668;<code>RequestResponseBodyMethodProcessor</code>&#x7684;&#x65B9;&#x6CD5;<code>supportsReturnType</code>&#x5C31;&#x660E;&#x767D;<code>selectHandler</code>&#x662F;&#x5982;&#x4F55;&#x8D77;&#x4F5C;&#x7528;&#x7684;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsReturnType</span><span class="params">(MethodParameter returnType)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> (AnnotatedElementUtils.hasAnnotation(returnType.getContainingClass(), ResponseBody.class) ||</span><br><span class="line">            returnType.hasMethodAnnotation(ResponseBody.class));</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5904;&#x7406;&#x5668;&#x662F;&#x6A21;&#x4EFF;<code>@ResponseBody</code>,&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5728;<code>returnValueHandlers</code>&#x4E2D;<code>RequestResponseBodyMethodProcessor</code>&#x4F4D;&#x7F6E;&#x5904;&#x63D2;&#x5165;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5904;&#x7406;&#x5668;&#x5373;&#x53EF;</p>
<p>&#x90A3;&#x4E48;&#x9996;&#x5148;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E86;&#x89E3;&#x4E0B;<code>HandlerMethodReturnValueHandlerComposite</code>&#x7684;&#x5C5E;&#x6027;<code>returnValueHandlers</code>&#x662F;&#x5982;&#x4F55;&#x88AB;&#x52A0;&#x8F7D;&#x8D4B;&#x503C;&#x7684;&#xFF0C;&#x901A;&#x8FC7;&#x67E5;&#x770B;&#x8C03;&#x7528;&#x5173;&#x7CFB;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x73B0; returnValueHandlers &#x8D4B;&#x503C;&#x7684;&#x65B9;&#x6CD5;&#x4E3A;<code>addHandlers</code>,&#x6B64;&#x65B9;&#x6CD5;&#x88AB;&#x4E24;&#x5904;&#x8C03;&#x7528;</p>
<p>&#x7B2C;&#x4E00;&#x5904;,&#x8FD9;&#x91CC;&#x662F;&#x52A0;&#x8F7D; bean &#x65F6;&#x7684;&#x521D;&#x59CB;&#x5316;&#x65B9;&#x6CD5;&#xFF0C;&#x5373;&#x9ED8;&#x8BA4;<code>returnValueHandlers</code>&#x4E3A;<code>getDefaultReturnValueHandlers</code>&#x7684;&#x8FD4;&#x56DE;&#x503C;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// Do this first, it may add ResponseBody advice beans</span></span><br><span class="line">    initControllerAdviceCache();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.argumentResolvers == <span class="keyword">null</span>) {</span><br><span class="line">        List&lt;HandlerMethodArgumentResolver&gt; resolvers = getDefaultArgumentResolvers();</span><br><span class="line">        <span class="keyword">this</span>.argumentResolvers = <span class="keyword">new</span> HandlerMethodArgumentResolverComposite().addResolvers(resolvers);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.initBinderArgumentResolvers == <span class="keyword">null</span>) {</span><br><span class="line">        List&lt;HandlerMethodArgumentResolver&gt; resolvers = getDefaultInitBinderArgumentResolvers();</span><br><span class="line">        <span class="keyword">this</span>.initBinderArgumentResolvers = <span class="keyword">new</span> HandlerMethodArgumentResolverComposite().addResolvers(resolvers);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.returnValueHandlers == <span class="keyword">null</span>) {</span><br><span class="line">        List&lt;HandlerMethodReturnValueHandler&gt; handlers = getDefaultReturnValueHandlers();</span><br><span class="line">        <span class="keyword">this</span>.returnValueHandlers = <span class="keyword">new</span> HandlerMethodReturnValueHandlerComposite().addHandlers(handlers);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x7B2C;&#x4E8C;&#x5904;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setReturnValueHandlers</span><span class="params">(@Nullable List&lt;HandlerMethodReturnValueHandler&gt; returnValueHandlers)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (returnValueHandlers == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">this</span>.returnValueHandlers = <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">this</span>.returnValueHandlers = <span class="keyword">new</span> HandlerMethodReturnValueHandlerComposite();</span><br><span class="line">        <span class="keyword">this</span>.returnValueHandlers.addHandlers(returnValueHandlers);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x660E;&#x663E;&#x6211;&#x4EEC;&#x65E0;&#x6CD5;&#x6539;&#x53D8;<code>afterPropertiesSet</code>&#x7684;&#x5B9E;&#x73B0;&#x7EC6;&#x8282;&#xFF0C;&#x90A3;&#x4E48;&#x7EE7;&#x627F;<code>WebMvcConfigurationSupport</code>,&#x91CD;&#x5199;<code>RequestMappingHandlerAdapter</code>&#x65B9;&#x6CD5;&#xFF0C;&#x624B;&#x52A8;&#x8C03;&#x7528;<code>setReturnValueHandlers</code>&#x65B9;&#x6CD5;&#x5373;&#x53EF;&#x6CE8;&#x5165;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5904;&#x7406;&#x5668;&#x3002; &#x4F46;&#x662F;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x53D6;&#x51FA;&#x9ED8;&#x8BA4;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x5904;&#x7406;&#x5668;&#xFF0C;&#x907F;&#x514D;&#x5176;&#x4ED6;&#x8FD4;&#x56DE;&#x503C;&#x5904;&#x7406;&#x5668;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#xFF0C;<code>getDefaultReturnValueHandlers</code>&#x662F;&#x79C1;&#x6709;&#x65B9;&#x6CD5;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x53CD;&#x5C04;&#x53D6;&#x503C;&#x3002;&#x7136;&#x540E;&#x5C06;&#x81EA;&#x5B9A;&#x4E49;&#x5904;&#x7406;&#x5668;&#x63D2;&#x5165;&#x5230;<code>RequestResponseBodyMethodProcessor</code>&#x4E4B;&#x524D;&#x5373;&#x53EF;, &#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x4F1A;&#x4F7F;<code>@ControllerAdvice</code>&#x5931;&#x6548;&#xFF0C;&#x614E;&#x7528;&#xFF0C;&#x66F4;&#x597D;&#x7684;&#x65B9;&#x5F0F;&#x901A;&#x8FC7;<code>@ControllerAdvice</code>&#x5B9E;&#x73B0;&#x540C;&#x6837;&#x7684;&#x6548;&#x679C;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.li.springboot.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.method.support.HandlerMethodReturnValueHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.RequestResponseBodyMethodProcessor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvc</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurationSupport</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RequestMappingHandlerAdapter <span class="title">requestMappingHandlerAdapter</span><span class="params">()</span> </span>{</span><br><span class="line">        RequestMappingHandlerAdapter requestMappingHandlerAdapter = <span class="keyword">super</span>.requestMappingHandlerAdapter();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            Method method = RequestMappingHandlerAdapter.class.getDeclaredMethod(<span class="string">&quot;getDefaultReturnValueHandlers&quot;</span>);</span><br><span class="line">            method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            List&lt;HandlerMethodReturnValueHandler&gt; returnValueHandlers = (List&lt;HandlerMethodReturnValueHandler&gt;) method.invoke(requestMappingHandlerAdapter);</span><br><span class="line">            System.out.println(<span class="string">&quot;invoke &quot;</span> + returnValueHandlers);</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (HandlerMethodReturnValueHandler handlerMethodReturnValueHandler : returnValueHandlers) {</span><br><span class="line">                <span class="keyword">if</span> (handlerMethodReturnValueHandler <span class="keyword">instanceof</span> RequestResponseBodyMethodProcessor) {</span><br><span class="line">                    returnValueHandlers.add(i, <span class="keyword">new</span> MyReturnValueHandler(getMessageConverters()));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                }</span><br><span class="line">                i++;</span><br><span class="line">            }</span><br><span class="line">            requestMappingHandlerAdapter.setReturnValueHandlers(returnValueHandlers);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> requestMappingHandlerAdapter;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.li.springboot.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.li.springboot.annotation.MyResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.MethodParameter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.HttpMessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.support.WebDataBinderFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.NativeWebRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.method.support.ModelAndViewContainer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyReturnValueHandler</span> <span class="keyword">extends</span> <span class="title">AbstractMessageConverterMethodProcessor</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">MyReturnValueHandler</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(converters);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsParameter</span><span class="params">(MethodParameter parameter)</span> </span>{</span><br><span class="line">        <span class="comment">//&#x4E0D;&#x9700;&#x8981;&#x652F;&#x6301;&#x8BF7;&#x6C42;&#x53C2;&#x6570;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">resolveArgument</span><span class="params">(MethodParameter parameter, ModelAndViewContainer mavContainer, NativeWebRequest webRequest, WebDataBinderFactory binderFactory)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsReturnType</span><span class="params">(MethodParameter returnType)</span> </span>{</span><br><span class="line">        <span class="comment">//&#x6709;&#x6CE8;&#x89E3;@MyResponseBody&#x7684;&#x4F7F;&#x7528;&#x8BE5;&#x5904;&#x7406;&#x5668;</span></span><br><span class="line">        <span class="keyword">return</span> returnType.getMethodAnnotation(MyResponseBody.class) != <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleReturnValue</span><span class="params">(Object returnValue, MethodParameter returnType, ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        mavContainer.setRequestHandled(<span class="keyword">true</span>);</span><br><span class="line">        Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">        map.put(<span class="string">&quot;data&quot;</span>,returnValue);</span><br><span class="line">        <span class="comment">//&#x66FF;&#x6362;&#x8FD4;&#x56DE;&#x503C;</span></span><br><span class="line">        writeWithMessageConverters(map, returnType, webRequest);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5B9E;&#x73B0;&#x540E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD4;&#x56DE;&#x503C;&#x5904;&#x7406;&#x5668;&#x7684;&#x96C6;&#x5408;&#x53D8;&#x5316; <img src="/images/Spring&#x81EA;&#x5B9A;&#x4E49;ReturnValueHandlers_&#x8FD4;&#x56DE;&#x503C;&#x5904;&#x7406;&#x5668;2.jpg" alt="&#x8FD4;&#x56DE;&#x503C;&#x5904;&#x7406;&#x5668;2"></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://leaderli.github.io/2019/08/04/idea-debug/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lijun">
      <meta itemprop="description" content="与其感慨路难行，不如马上就出发">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大狗哥传奇">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/08/04/idea-debug/" class="post-title-link" itemprop="url">idea debug</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-08-04 22:43:05" itemprop="dateCreated datePublished" datetime="2019-08-04T22:43:05+08:00">2019-08-04</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-15 00:26:45" itemprop="dateModified" datetime="2019-08-15T00:26:45+08:00">2019-08-15</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/idea/" itemprop="url" rel="index"><span itemprop="name">idea</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>IDEA&#x5F00;&#x53D1;web&#x9879;&#x76EE;&#x65F6;&#xFF0C;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;<code>debug</code>&#x542F;&#x52A8;&#x6A21;&#x5F0F;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x968F;&#x65F6;&#x6253;&#x65AD;&#x70B9;&#x8C03;&#x8BD5;&#x9879;&#x76EE;</p>
</blockquote>
<h2 id="&#x4F7F;&#x7528;&#x5F02;&#x5E38;&#x7C7B;&#x578B;&#x65AD;&#x70B9;&#x5728;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x65F6;&#x5FEB;&#x901F;&#x8FDB;&#x5165;&#x62A5;&#x9519;&#x70B9;">1. &#x4F7F;&#x7528;&#x5F02;&#x5E38;&#x7C7B;&#x578B;&#x65AD;&#x70B9;&#xFF0C;&#x5728;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x65F6;&#x5FEB;&#x901F;&#x8FDB;&#x5165;&#x62A5;&#x9519;&#x70B9;</h2>
<h2 id="&#x65AD;&#x70B9;&#x8BBE;&#x7F6E;condition&#x4EC5;&#x5F53;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x65F6;&#x89E6;&#x53D1;&#x65AD;&#x70B9;">2. &#x65AD;&#x70B9;&#x8BBE;&#x7F6E;<code>condition</code>&#xFF0C;&#x4EC5;&#x5F53;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x65F6;&#x89E6;&#x53D1;&#x65AD;&#x70B9;</h2>
<h2 id="&#x65AD;&#x70B9;&#x53EF;&#x8BBE;&#x7F6E;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x4EC5;&#x5728;&#x524D;&#x7F6E;&#x65AD;&#x70B9;&#x89E6;&#x53D1;&#x540E;&#x518D;&#x89E6;&#x53D1;">3. &#x65AD;&#x70B9;&#x53EF;&#x8BBE;&#x7F6E;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#xFF0C;&#x4EC5;&#x5728;&#x524D;&#x7F6E;&#x65AD;&#x70B9;&#x89E6;&#x53D1;&#x540E;&#x518D;&#x89E6;&#x53D1;</h2>
<h2 id="evaluate-expression&#x53EF;&#x7F16;&#x5199;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;">4. <code>evaluate Expression</code>&#x53EF;&#x7F16;&#x5199;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;</h2>
<h2 id="&#x4F7F;&#x7528;watches&#x76D1;&#x542C;&#x5C5E;&#x6027;&#x7684;&#x53D8;&#x5316;">5. &#x4F7F;&#x7528;<code>watches</code>&#x76D1;&#x542C;&#x5C5E;&#x6027;&#x7684;&#x53D8;&#x5316;</h2>
<h2 id="variables&#x76F4;&#x63A5;&#x4FEE;&#x6539;&#x5C5E;&#x6027;&#x503C;&#x8FDB;&#x884C;&#x8C03;&#x8BD5;">6. <code>variables</code>&#x76F4;&#x63A5;&#x4FEE;&#x6539;&#x5C5E;&#x6027;&#x503C;&#xFF0C;&#x8FDB;&#x884C;&#x8C03;&#x8BD5;</h2>
<h2 id="&#x6307;&#x5B9A;&#x7EBF;&#x7A0B;&#x4E0B;&#x89E6;&#x53D1;&#x65AD;&#x70B9;">7. &#x6307;&#x5B9A;&#x7EBF;&#x7A0B;&#x4E0B;&#x89E6;&#x53D1;&#x65AD;&#x70B9;</h2>
<h2 id="&#x79FB;&#x52A8;&#x5230;&#x4E0B;&#x4E2A;&#x65AD;&#x70B9;">8. &#x79FB;&#x52A8;&#x5230;&#x4E0B;&#x4E2A;&#x65AD;&#x70B9;</h2>
<h2 id="option-&#x5DE6;&#x952E;-&#x67E5;&#x770B;&#x53D8;&#x91CF;&#x503C;">option + &#x5DE6;&#x952E; &#x67E5;&#x770B;&#x53D8;&#x91CF;&#x503C;</h2>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://leaderli.github.io/2019/08/04/spring静态资源加载源码浅析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lijun">
      <meta itemprop="description" content="与其感慨路难行，不如马上就出发">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大狗哥传奇">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/08/04/spring静态资源加载源码浅析/" class="post-title-link" itemprop="url">spring静态资源加载源码浅析</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-08-04 01:28:59 / 修改时间：18:53:03" itemprop="dateCreated datePublished" datetime="2019-08-04T01:28:59+08:00">2019-08-04</time>
            </span>
          

          
            

            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/springboot/" itemprop="url" rel="index"><span itemprop="name">springboot</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="&#x81EA;&#x5B9A;&#x4E49;&#x8D44;&#x6E90;&#x5904;&#x7406;&#x5668;">&#x81EA;&#x5B9A;&#x4E49;&#x8D44;&#x6E90;&#x5904;&#x7406;&#x5668;</h2>
<p><code>DispatcherServlet</code>&#x4F1A;&#x62E6;&#x622A;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#xFF0C;&#x9488;&#x5BF9;<code>js</code>,<code>css</code>&#x7B49;&#x9759;&#x6001;&#x8D44;&#x6E90;&#x6587;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x671F;&#x671B;&#x88AB;<code>controller</code>&#x62E6;&#x622A;&#xFF0C;&#x901A;&#x8FC7;&#x91CD;&#x5199;<code>WebMvcConfigurationSupport</code>&#x7684;<code>addResourceHandlers</code>&#x65B9;&#x6CD5;&#xFF0C;&#x7531;&#x62E6;&#x622A;&#x6307;&#x5B9A;&#x89C4;&#x5219;&#x7684;&#x8BF7;&#x6C42;url&#x3002;&#x4EE3;&#x7801;&#x5982;&#x4E0B;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.li.springboot.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvc</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurationSupport</span> </span>{</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>{</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/static&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/static&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h2 id="&#x6E90;&#x7801;&#x5206;&#x6790;">&#x6E90;&#x7801;&#x5206;&#x6790;</h2>
<p><code>SpringBoot</code>&#x62E6;&#x622A;url&#xFF0C;&#x6839;&#x636E;<code>HandlerMapping</code>&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;<code>Handler</code>&#x53BB;&#x6267;&#x884C;&#x76F8;&#x5173;&#x64CD;&#x4F5C;&#x3002;</p>
<p><code>DispatcherServlet</code>&#x521D;&#x59CB;&#x5316;&#x65F6;&#x4F1A;&#x8C03;&#x7528;&#x521D;&#x59CB;&#x5316;&#x65B9;&#x6CD5;&#x65F6;&#x4F1A;&#x52A0;&#x8F7D;<code>HandlerMapping</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initHandlerMappings</span><span class="params">(ApplicationContext context)</span> </span>{</span><br><span class="line">    <span class="keyword">this</span>.handlerMappings = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.detectAllHandlerMappings) {</span><br><span class="line">        <span class="comment">// &#x67E5;&#x627E;&#x6240;&#x6709;HandlerMapping&#x5B9E;&#x73B0;&#x7C7B;</span></span><br><span class="line">        Map&lt;String, HandlerMapping&gt; matchingBeans =</span><br><span class="line">                BeanFactoryUtils.beansOfTypeIncludingAncestors(context, HandlerMapping.class, <span class="keyword">true</span>, <span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">if</span> (!matchingBeans.isEmpty()) {</span><br><span class="line">            <span class="keyword">this</span>.handlerMappings = <span class="keyword">new</span> ArrayList&lt;&gt;(matchingBeans.values());</span><br><span class="line">            <span class="comment">// We keep HandlerMappings in sorted order.</span></span><br><span class="line">            AnnotationAwareOrderComparator.sort(<span class="keyword">this</span>.handlerMappings);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><code>WebMvcConfigurationSupport</code>&#x7684;&#x65B9;&#x6CD5;<code>resourceHandlerMapping</code>&#x4E2D;&#x6CE8;&#x89E3;&#x4E86;<code>@Bean</code>&#xFF0C;&#x6240;&#x4EE5;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x8D44;&#x6E90;&#x5904;&#x7406;&#x5668;&#x7C7B;&#x5F97;&#x4EE5;&#x88AB;&#x52A0;&#x8F7D;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HandlerMapping <span class="title">resourceHandlerMapping</span><span class="params">()</span> </span>{</span><br><span class="line">    Assert.state(<span class="keyword">this</span>.applicationContext != <span class="keyword">null</span>, <span class="string">&quot;No ApplicationContext set&quot;</span>);</span><br><span class="line">    Assert.state(<span class="keyword">this</span>.servletContext != <span class="keyword">null</span>, <span class="string">&quot;No ServletContext set&quot;</span>);</span><br><span class="line"></span><br><span class="line">    ResourceHandlerRegistry registry = <span class="keyword">new</span> ResourceHandlerRegistry(<span class="keyword">this</span>.applicationContext,</span><br><span class="line">            <span class="keyword">this</span>.servletContext, mvcContentNegotiationManager(), mvcUrlPathHelper());</span><br><span class="line">    <span class="comment">// &#x6211;&#x4EEC;&#x91CD;&#x5199;&#x7684;&#x65B9;&#x6CD5;</span></span><br><span class="line">    addResourceHandlers(registry);</span><br><span class="line"></span><br><span class="line">    AbstractHandlerMapping handlerMapping = registry.getHandlerMapping();</span><br><span class="line">    <span class="keyword">if</span> (handlerMapping == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    handlerMapping.setPathMatcher(mvcPathMatcher());</span><br><span class="line">    handlerMapping.setUrlPathHelper(mvcUrlPathHelper());</span><br><span class="line">    handlerMapping.setInterceptors(getInterceptors());</span><br><span class="line">    handlerMapping.setCorsConfigurations(getCorsConfigurations());</span><br><span class="line">    <span class="keyword">return</span> handlerMapping;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x91CD;&#x5199;&#x7684;&#x65B9;&#x6CD5;<code>new</code>&#x4E86;<code>ResourceHandlerRegistration</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ResourceHandlerRegistration <span class="title">addResourceHandler</span><span class="params">(String... pathPatterns)</span> </span>{</span><br><span class="line">    ResourceHandlerRegistration registration = <span class="keyword">new</span> ResourceHandlerRegistration(pathPatterns);</span><br><span class="line">    <span class="keyword">this</span>.registrations.add(registration);</span><br><span class="line">    <span class="keyword">return</span> registration;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8FD4;&#x56DE;&#x5230;<code>WebMvcConfigurationSupport</code>&#x65B9;&#x6CD5;<code>resourceHandlerMapping</code>&#x7684;<code>registry.getHandlerMapping()</code>&#x4E2D;&#xFF0C;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> AbstractHandlerMapping <span class="title">getHandlerMapping</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.registrations.isEmpty()) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Map&lt;String, HttpRequestHandler&gt; urlMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (ResourceHandlerRegistration registration : <span class="keyword">this</span>.registrations) {</span><br><span class="line">        <span class="keyword">for</span> (String pathPattern : registration.getPathPatterns()) {</span><br><span class="line">            <span class="comment">//&#x627E;&#x5230;&#x5B9E;&#x9645;handler</span></span><br><span class="line">            ResourceHttpRequestHandler handler = registration.getRequestHandler();</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.pathHelper != <span class="keyword">null</span>) {</span><br><span class="line">                handler.setUrlPathHelper(<span class="keyword">this</span>.pathHelper);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.contentNegotiationManager != <span class="keyword">null</span>) {</span><br><span class="line">                handler.setContentNegotiationManager(<span class="keyword">this</span>.contentNegotiationManager);</span><br><span class="line">            }</span><br><span class="line">            handler.setServletContext(<span class="keyword">this</span>.servletContext);</span><br><span class="line">            handler.setApplicationContext(<span class="keyword">this</span>.applicationContext);</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                handler.afterPropertiesSet();</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">catch</span> (Throwable ex) {</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BeanInitializationException(<span class="string">&quot;Failed to init ResourceHttpRequestHandler&quot;</span>, ex);</span><br><span class="line">            }</span><br><span class="line">            urlMap.put(pathPattern, handler);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    SimpleUrlHandlerMapping handlerMapping = <span class="keyword">new</span> SimpleUrlHandlerMapping();</span><br><span class="line">    handlerMapping.setOrder(<span class="keyword">this</span>.order);</span><br><span class="line">    handlerMapping.setUrlMap(urlMap);</span><br><span class="line">    <span class="keyword">return</span> handlerMapping;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><code>ResourceHandlerRegistration</code>&#x7684;<code>getRequestHandler</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> ResourceHttpRequestHandler <span class="title">getRequestHandler</span><span class="params">()</span> </span>{</span><br><span class="line">    ResourceHttpRequestHandler handler = <span class="keyword">new</span> ResourceHttpRequestHandler();</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.resourceChainRegistration != <span class="keyword">null</span>) {</span><br><span class="line">        handler.setResourceResolvers(<span class="keyword">this</span>.resourceChainRegistration.getResourceResolvers());</span><br><span class="line">        handler.setResourceTransformers(<span class="keyword">this</span>.resourceChainRegistration.getResourceTransformers());</span><br><span class="line">    }</span><br><span class="line">    handler.setLocationValues(<span class="keyword">this</span>.locationValues);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.cacheControl != <span class="keyword">null</span>) {</span><br><span class="line">        handler.setCacheControl(<span class="keyword">this</span>.cacheControl);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.cachePeriod != <span class="keyword">null</span>) {</span><br><span class="line">        handler.setCacheSeconds(<span class="keyword">this</span>.cachePeriod);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> handler;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x53EA;&#x9700;&#x8981;&#x641E;&#x6E05;&#x695A;<code>ResourceHttpRequestHandler</code>&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x5982;&#x4F55;&#x88AB;&#x8C03;&#x7528;&#x5373;&#x53EF;&#x3002;</p>
<p><code>SpringBoot</code>&#x6216;&#x8005;<code>SpringMVC</code>&#x7684;&#x8BF7;&#x6C42;&#x7531;<code>DispatcherServlet</code>&#x62E6;&#x622A;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;<code>Servlet</code>&#x6807;&#x51C6;&#x3002;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x4ECE;<code>service</code>&#x65B9;&#x6CD5;&#x5165;&#x53E3;&#x5373;&#x53EF;</p>
<p><code>DispatcherServlet</code>&#x7684;&#x7236;&#x7C7B;<code>FrameworkServlet</code>&#x91CD;&#x5199;&#x4E86;<code>service</code>&#x65B9;&#x6CD5;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServletException, IOException </span>{</span><br><span class="line"></span><br><span class="line">    HttpMethod httpMethod = HttpMethod.resolve(request.getMethod());</span><br><span class="line">    <span class="keyword">if</span> (httpMethod == HttpMethod.PATCH || httpMethod == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        processRequest(request, response);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">super</span>.service(request, response);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><code>processRequest</code>&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x5B9E;&#x9645;&#x7531;<code>DispatcherServlet</code>&#x5B9E;&#x73B0;&#x7684;&#x65B9;&#x6CD5;<code>doService</code>&#x53BB;&#x5904;&#x7406;&#x3002;&#x800C;<code>doService</code>&#x6700;&#x7EC8;&#x8C03;&#x7528;<code>doDispatch</code>&#x65B9;&#x6CD5;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">    HttpServletRequest processedRequest = request;</span><br><span class="line">    HandlerExecutionChain mappedHandler = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">boolean</span> multipartRequestParsed = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        ModelAndView mv = <span class="keyword">null</span>;</span><br><span class="line">        Exception dispatchException = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            processedRequest = checkMultipart(request);</span><br><span class="line">            multipartRequestParsed = (processedRequest != request);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//&#x67E5;&#x627E;&#x5408;&#x9002;&#x7684;handlerMapping</span></span><br><span class="line">            mappedHandler = getHandler(processedRequest);</span><br><span class="line">            <span class="keyword">if</span> (mappedHandler == <span class="keyword">null</span>) {</span><br><span class="line">                noHandlerFound(processedRequest, response);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Determine handler adapter for the current request.</span></span><br><span class="line">            HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Process last-modified header, if supported by the handler.</span></span><br><span class="line">            String method = request.getMethod();</span><br><span class="line">            <span class="keyword">boolean</span> isGet = <span class="string">&quot;GET&quot;</span>.equals(method);</span><br><span class="line">            <span class="keyword">if</span> (isGet || <span class="string">&quot;HEAD&quot;</span>.equals(method)) {</span><br><span class="line">                <span class="keyword">long</span> lastModified = ha.getLastModified(request, mappedHandler.getHandler());</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">new</span> ServletWebRequest(request, response).checkNotModified(lastModified) &amp;&amp; isGet) {</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!mappedHandler.applyPreHandle(processedRequest, response)) {</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ha&#x5B9E;&#x9645;&#x4F7F;&#x7528;HttpRequestHandlerAdapter&#xFF0C;mappedHandler.getHandler()&#x5219;&#x4E3A;ResourceHttpRequestHandler</span></span><br><span class="line">            mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) {</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            applyDefaultViewName(processedRequest, mv);</span><br><span class="line">            mappedHandler.applyPostHandle(processedRequest, response, mv);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex) {</span><br><span class="line">            dispatchException = ex;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span> (Throwable err) {</span><br><span class="line">            <span class="comment">// As of 4.3, we&apos;re processing Errors thrown from handler methods as well,</span></span><br><span class="line">            <span class="comment">// making them available for @ExceptionHandler methods and other scenarios.</span></span><br><span class="line">            dispatchException = <span class="keyword">new</span> NestedServletException(<span class="string">&quot;Handler dispatch failed&quot;</span>, err);</span><br><span class="line">        }</span><br><span class="line">        processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">catch</span> (Exception ex) {</span><br><span class="line">        triggerAfterCompletion(processedRequest, response, mappedHandler, ex);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">catch</span> (Throwable err) {</span><br><span class="line">        triggerAfterCompletion(processedRequest, response, mappedHandler,</span><br><span class="line">                <span class="keyword">new</span> NestedServletException(<span class="string">&quot;Handler processing failed&quot;</span>, err));</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">finally</span> {</span><br><span class="line">        <span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) {</span><br><span class="line">            <span class="comment">// Instead of postHandle and afterCompletion</span></span><br><span class="line">            <span class="keyword">if</span> (mappedHandler != <span class="keyword">null</span>) {</span><br><span class="line">                mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">// Clean up any resources used by a multipart request.</span></span><br><span class="line">            <span class="keyword">if</span> (multipartRequestParsed) {</span><br><span class="line">                cleanupMultipart(processedRequest);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x67E5;&#x770B;&#x5177;&#x4F53;&#x67E5;&#x627E;<code>mappedHandler</code>&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;,</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> HandlerExecutionChain <span class="title">getHandler</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">    <span class="comment">//handlerMappings&#x7684;&#x52A0;&#x8F7D;&#x5728;&#x4E0A;&#x6587;&#x4E2D;&#x6709;&#x8BE6;&#x7EC6;&#x89E3;&#x91CA;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x52A0;&#x8F7D;&#x4E86;ResourceHttpRequestHandler</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.handlerMappings != <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">for</span> (HandlerMapping mapping : <span class="keyword">this</span>.handlerMappings) {</span><br><span class="line">            HandlerExecutionChain handler = mapping.getHandler(request);</span><br><span class="line">            <span class="keyword">if</span> (handler != <span class="keyword">null</span>) {</span><br><span class="line">                <span class="keyword">return</span> handler;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x63A5;&#x7740;&#x6211;&#x4EEC;&#x67E5;&#x770B;&#x67E5;&#x627E;&#x5177;&#x4F53;<code>handlerAdapter</code>&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> HandlerAdapter <span class="title">getHandlerAdapter</span><span class="params">(Object handler)</span> <span class="keyword">throws</span> ServletException </span>{</span><br><span class="line">    <span class="comment">//&#x548C;handlerMappings&#x7684;&#x52A0;&#x8F7D;&#x4EE3;&#x7801;&#x7EC6;&#x8282;&#x4E00;&#x6837;&#xFF0C;&#x8FD9;&#x91CC;&#x52A0;&#x8F7D;&#x4E86;HttpRequestHandlerAdapter</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.handlerAdapters != <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">for</span> (HandlerAdapter adapter : <span class="keyword">this</span>.handlerAdapters) {</span><br><span class="line">            <span class="keyword">if</span> (adapter.supports(handler)) {</span><br><span class="line">                <span class="keyword">return</span> adapter;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">&quot;No adapter for handler [&quot;</span> + handler +</span><br><span class="line">            <span class="string">&quot;]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler&quot;</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><code>handlerAdapter</code>&#x8C03;&#x7528;<code>handle</code>,&#x5BF9;&#x4E8E;<code>HttpRequestHandlerAdapter</code>&#x6765;&#x8BF4;&#xFF0C;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> Exception </span>{</span><br><span class="line"></span><br><span class="line">    ((HttpRequestHandler) handler).handleRequest(request, response);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x90A3;&#x4E48;&#x6839;&#x636E;<code>doDispatch</code>&#x4E2D;&#x4F20;&#x5165;&#x7684;<code>handler</code>&#x5373;&#x5219;&#x4E3A;<code>ResourceHttpRequestHandler</code>,&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8D44;&#x6E90;&#x6587;&#x4EF6;&#x7684;&#x5177;&#x4F53;&#x52A0;&#x8F7D;&#x8FC7;&#x7A0B;&#x3002;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleRequest</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServletException, IOException </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">// For very general mappings (e.g. &quot;/&quot;) we need to check 404 first</span></span><br><span class="line">    Resource resource = getResource(request);</span><br><span class="line">    <span class="keyword">if</span> (resource == <span class="keyword">null</span>) {</span><br><span class="line">        logger.debug(<span class="string">&quot;Resource not found&quot;</span>);</span><br><span class="line">        response.sendError(HttpServletResponse.SC_NOT_FOUND);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (HttpMethod.OPTIONS.matches(request.getMethod())) {</span><br><span class="line">        response.setHeader(<span class="string">&quot;Allow&quot;</span>, getAllowHeader());</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Supported methods and required session</span></span><br><span class="line">    checkRequest(request);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Header phase</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">new</span> ServletWebRequest(request, response).checkNotModified(resource.lastModified())) {</span><br><span class="line">        logger.trace(<span class="string">&quot;Resource not modified&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Apply cache settings, if any</span></span><br><span class="line">    prepareResponse(response);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check the media type for the resource</span></span><br><span class="line">    MediaType mediaType = getMediaType(request, resource);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Content phase</span></span><br><span class="line">    <span class="keyword">if</span> (METHOD_HEAD.equals(request.getMethod())) {</span><br><span class="line">        setHeaders(response, resource, mediaType);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    ServletServerHttpResponse outputMessage = <span class="keyword">new</span> ServletServerHttpResponse(response);</span><br><span class="line">    <span class="keyword">if</span> (request.getHeader(HttpHeaders.RANGE) == <span class="keyword">null</span>) {</span><br><span class="line">        Assert.state(<span class="keyword">this</span>.resourceHttpMessageConverter != <span class="keyword">null</span>, <span class="string">&quot;Not initialized&quot;</span>);</span><br><span class="line">        setHeaders(response, resource, mediaType);</span><br><span class="line">        <span class="keyword">this</span>.resourceHttpMessageConverter.write(resource, mediaType, outputMessage);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">        Assert.state(<span class="keyword">this</span>.resourceRegionHttpMessageConverter != <span class="keyword">null</span>, <span class="string">&quot;Not initialized&quot;</span>);</span><br><span class="line">        response.setHeader(HttpHeaders.ACCEPT_RANGES, <span class="string">&quot;bytes&quot;</span>);</span><br><span class="line">        ServletServerHttpRequest inputMessage = <span class="keyword">new</span> ServletServerHttpRequest(request);</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            List&lt;HttpRange&gt; httpRanges = inputMessage.getHeaders().getRange();</span><br><span class="line">            response.setStatus(HttpServletResponse.SC_PARTIAL_CONTENT);</span><br><span class="line">            <span class="keyword">this</span>.resourceRegionHttpMessageConverter.write(</span><br><span class="line">                    HttpRange.toResourceRegions(httpRanges, resource), mediaType, outputMessage);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span> (IllegalArgumentException ex) {</span><br><span class="line">            response.setHeader(<span class="string">&quot;Content-Range&quot;</span>, <span class="string">&quot;bytes */&quot;</span> + resource.contentLength());</span><br><span class="line">            response.sendError(HttpServletResponse.SC_REQUESTED_RANGE_NOT_SATISFIABLE);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://leaderli.github.io/2019/08/02/springboot静态资源定义mime类型/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lijun">
      <meta itemprop="description" content="与其感慨路难行，不如马上就出发">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大狗哥传奇">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/08/02/springboot静态资源定义mime类型/" class="post-title-link" itemprop="url">springboot静态资源定义mime类型</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-08-02 23:52:43" itemprop="dateCreated datePublished" datetime="2019-08-02T23:52:43+08:00">2019-08-02</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-04 19:28:35" itemprop="dateModified" datetime="2019-08-04T19:28:35+08:00">2019-08-04</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/springboot/" itemprop="url" rel="index"><span itemprop="name">springboot</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="&#x95EE;&#x9898;&#x63CF;&#x8FF0;">&#x95EE;&#x9898;&#x63CF;&#x8FF0;</h2>
<p>&#x9879;&#x76EE;&#x4E2D;&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x9759;&#x6001;&#x8D44;&#x6E90;&#x6587;&#x4EF6;<code>xxx.ccxml</code>,&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x4E0D;&#x5C5E;&#x4E8E;&#x6807;&#x51C6;&#x7684;&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#x3002;&#x6D4F;&#x89C8;&#x5668;&#x8BBF;&#x95EE;&#x65F6;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E0B;&#x8F7D;&#x8BE5;&#x6587;&#x4EF6;&#x3002;&#x6211;&#x4EEC;&#x662F;&#x671F;&#x671B;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x9875;&#x9762;&#x4E0A;&#x67E5;&#x770B;&#x7684;&#x3002;</p>
<h2 id="&#x80CC;&#x666F;&#x77E5;&#x8BC6;">&#x80CC;&#x666F;&#x77E5;&#x8BC6;</h2>
<blockquote>
<p>MIME(Multipurpose Internet Mail Extensions)&#x591A;&#x7528;&#x9014;&#x4E92;&#x8054;&#x7F51;&#x90AE;&#x4EF6;&#x6269;&#x5C55;&#x7C7B;&#x578B;&#x3002;&#x662F;&#x8BBE;&#x5B9A;&#x67D0;&#x79CD;&#x6269;&#x5C55;&#x540D;&#x7684;&#x6587;&#x4EF6;&#x7528;&#x4E00;&#x79CD;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6765;&#x6253;&#x5F00;&#x7684;&#x65B9;&#x5F0F;&#x7C7B;&#x578B;&#xFF0C;&#x5F53;&#x8BE5;&#x6269;&#x5C55;&#x540D;&#x6587;&#x4EF6;&#x88AB;&#x8BBF;&#x95EE;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x81EA;&#x52A8;&#x4F7F;&#x7528;&#x6307;&#x5B9A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6765;&#x6253;&#x5F00;&#x3002;&#x591A;&#x7528;&#x4E8E;&#x6307;&#x5B9A;&#x4E00;&#x4E9B;&#x5BA2;&#x6237;&#x7AEF;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x4EE5;&#x53CA;&#x4E00;&#x4E9B;&#x5A92;&#x4F53;&#x6587;&#x4EF6;&#x6253;&#x5F00;&#x65B9;&#x5F0F;&#x3002;</p>
</blockquote>
<p>&#x8BE6;&#x60C5;&#x53EF;&#x53C2;&#x8003;<a href="https://baike.baidu.com/item/MIME/2900607?fr=aladdin" target="_blank" rel="noopener">MIME&#x53C2;&#x8003;&#x6587;&#x6863;</a></p>
<h2 id="&#x89E3;&#x51B3;&#x65B9;&#x6848;">&#x89E3;&#x51B3;&#x65B9;&#x6848;</h2>
<p>&#x6211;&#x4EEC;&#x6CE8;&#x518C;&#x5173;&#x4E8E;<code>ccxml</code>&#x6269;&#x5C55;&#x7C7B;&#x578B;&#x7684;&#x9ED8;&#x8BA4;&#x6253;&#x5F00;&#x65B9;&#x5F0F;&#x5373;&#x53EF;&#x3002;</p>
<p>&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5728;<code>tomcat</code>&#x76EE;&#x5F55;&#x4E0B;&#x7684;<code>conf/web.xml</code>&#x4FEE;&#x6539;&#x6216;&#x65B0;&#x589E;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mime-mapping</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">extension</span>&gt;</span>ccxml<span class="tag">&lt;/<span class="name">extension</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">mime-type</span>&gt;</span>application/xml<span class="tag">&lt;/<span class="name">mime-type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mime-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&#x9488;&#x5BF9;&#x4E8E;<code>SpringBoot</code>&#x7684;&#x5185;&#x7F6E;&#x5BB9;&#x5668;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x63A5;&#x53E3;&#x4EE5;&#x4F9B;&#x4FEE;&#x6539;</p>
<p>Spring Boot 1:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HbbtvMimeMapping</span> <span class="keyword">implements</span> <span class="title">EmbeddedServletContainerCustomizer</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(ConfigurableEmbeddedServletContainer container)</span> </span>{</span><br><span class="line">        MimeMappings mappings = <span class="keyword">new</span> MimeMappings(MimeMappings.DEFAULT);</span><br><span class="line">        mappings.add(<span class="string">&quot;ccxml&quot;</span>, <span class="string">&quot;application/xml; charset=utf-8&quot;</span>);</span><br><span class="line">        container.setMimeMappings(mappings);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>Spring Boot 2:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HbbtvMimeMapping</span> <span class="keyword">implements</span> <span class="title">WebServerFactoryCustomizer</span>&lt;<span class="title">ConfigurableServletWebServerFactory</span>&gt; </span>{</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(ConfigurableServletWebServerFactory factory)</span> </span>{</span><br><span class="line">        MimeMappings mappings = <span class="keyword">new</span> MimeMappings(MimeMappings.DEFAULT);</span><br><span class="line">        mappings.add(<span class="string">&quot;ccxml&quot;</span>, <span class="string">&quot;application/xml; charset=utf-8&quot;</span>);</span><br><span class="line">        factory.setMimeMappings(mappings);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h2 id="spring&#x52A0;&#x8F7D;&#x9759;&#x6001;&#x8D44;&#x6E90;&#x7684;mime&#x6E90;&#x7801;&#x5206;&#x6790;">Spring&#x52A0;&#x8F7D;&#x9759;&#x6001;&#x8D44;&#x6E90;&#x7684;<code>mime</code>&#x6E90;&#x7801;&#x5206;&#x6790;</h2>
<p>&#x9488;&#x5BF9;<code>SpringBoot2</code>&#xFF0C;&#x4E00;&#x822C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#x662F;<code>tomcat</code>&#x5BB9;&#x5668;,&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x52A0;&#x8F7D;<code>mimeType</code>&#x7684;&#x7C7B;&#x6CE8;&#x5165;&#x4E86;<code>ConfigurableServletWebServerFactory</code>&#x5B9E;&#x73B0;&#x7C7B;&#x4E2D;<code>TomcatServletWebServerFactory</code>&#xFF0C;&#x5176;&#x65B9;&#x6CD5;<code>configureContext</code>&#x5C06;&#x81EA;&#x5B9A;&#x4E49;&#x7684;<code>mimeType</code>&#x5B58;&#x50A8;&#x5230;&#x96C6;&#x5408;&#x4E2D; &#x8282;&#x9009;&#x7247;&#x6BB5;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (MimeMappings.Mapping mapping : getMimeMappings()) {</span><br><span class="line">    <span class="comment">//getMimeMappings&#x5373;&#x4E3A;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x6DFB;&#x52A0;&#x7684;&#x6269;&#x5C55;</span></span><br><span class="line">    <span class="comment">//context&#x5B9E;&#x73B0;&#x7C7B;StandardContext</span></span><br><span class="line">    context.addMimeMapping(mapping.getExtension(), mapping.getMimeType());</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><code>StandardContext</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addMimeMapping</span><span class="params">(String extension, String mimeType)</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">synchronized</span> (mimeMappings) {</span><br><span class="line">        <span class="comment">//&#x5BF9;&#x5916;&#x66B4;&#x9732;&#x7684;&#x63A5;&#x53E3;findMimeMapping</span></span><br><span class="line">        mimeMappings.put(extension.toLowerCase(Locale.ENGLISH), mimeType);</span><br><span class="line">    }</span><br><span class="line">    fireContainerEvent(<span class="string">&quot;addMimeMapping&quot;</span>, extension);</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x6839;&#x636E;<a href="/2019/08/04/spring&#x9759;&#x6001;&#x8D44;&#x6E90;&#x52A0;&#x8F7D;&#x6E90;&#x7801;&#x6D45;&#x6790;/" title="spring&#x9759;&#x6001;&#x8D44;&#x6E90;&#x52A0;&#x8F7D;&#x6E90;&#x7801;&#x6D45;&#x6790;">spring&#x9759;&#x6001;&#x8D44;&#x6E90;&#x52A0;&#x8F7D;&#x6E90;&#x7801;&#x6D45;&#x6790;</a>&#x4E2D;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x627E;&#x5230;<code>ResourceHttpRequestHandler</code>&#xFF0C;&#x5B9E;&#x9645;&#x6267;&#x884C;&#x65B9;&#x6CD5;<code>handleRequest</code>&#x8282;&#x9009;&#x4EE3;&#x7801;&#x7247;&#x6BB5;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MediaType mediaType = getMediaType(request, resource);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (METHOD_HEAD.equals(request.getMethod())) {</span><br><span class="line">    setHeaders(response, resource, mediaType);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x5148;&#x770B;&#x4E0B;<code>MediaType</code>&#x7684;&#x52A0;&#x8F7D;&#xFF0C;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> MediaType <span class="title">getMediaType</span><span class="params">(HttpServletRequest request, Resource resource)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">this</span>.contentNegotiationStrategy != <span class="keyword">null</span> ?</span><br><span class="line">            <span class="keyword">this</span>.contentNegotiationStrategy.getMediaTypeForResource(resource) : <span class="keyword">null</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><code>this.contentNegotiationStrategy</code>&#x6709;&#x65B9;&#x6CD5;<code>initContentNegotiationStrategy</code>&#x6765;&#x52A0;&#x8F7D;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> PathExtensionContentNegotiationStrategy <span class="title">initContentNegotiationStrategy</span><span class="params">()</span> </span>{</span><br><span class="line">    Map&lt;String, MediaType&gt; mediaTypes = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (getContentNegotiationManager() != <span class="keyword">null</span>) {</span><br><span class="line">        PathExtensionContentNegotiationStrategy strategy =</span><br><span class="line">                getContentNegotiationManager().getStrategy(PathExtensionContentNegotiationStrategy.class);</span><br><span class="line">        <span class="keyword">if</span> (strategy != <span class="keyword">null</span>) {</span><br><span class="line">            mediaTypes = <span class="keyword">new</span> HashMap&lt;&gt;(strategy.getMediaTypes());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#x52A0;&#x8F7D;ServletPathExtensionContentNegotiationStrategy</span></span><br><span class="line">    <span class="keyword">return</span> (getServletContext() != <span class="keyword">null</span> ?</span><br><span class="line">            <span class="keyword">new</span> ServletPathExtensionContentNegotiationStrategy(getServletContext(), mediaTypes) :</span><br><span class="line">            <span class="keyword">new</span> PathExtensionContentNegotiationStrategy(mediaTypes));</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x8FFD;&#x8E2A;<code>PathExtensionContentNegotiationStrategy</code>&#x7684;<code>getMediaTypeForResource</code>&#x65B9;&#x6CD5;&#x4E2D;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> MediaType <span class="title">getMediaTypeForResource</span><span class="params">(Resource resource)</span> </span>{</span><br><span class="line">    MediaType mediaType = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">//&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;mimeType&#x548C;servletcontext&#x4E0A;&#x4E0B;&#x6587;&#x6709;&#x5173;</span></span><br><span class="line">    String mimeType = <span class="keyword">this</span>.servletContext.getMimeType(resource.getFilename());</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasText(mimeType)) {</span><br><span class="line">        mediaType = MediaType.parseMediaType(mimeType);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (mediaType == <span class="keyword">null</span> || MediaType.APPLICATION_OCTET_STREAM.equals(mediaType)) {</span><br><span class="line">        MediaType superMediaType = <span class="keyword">super</span>.getMediaTypeForResource(resource);</span><br><span class="line">        <span class="keyword">if</span> (superMediaType != <span class="keyword">null</span>) {</span><br><span class="line">            mediaType = superMediaType;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> mediaType;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x770B;&#x4E0B;&#x5177;&#x4F53;&#x7684;<code>servletContext.getMimeType</code>&#x5B9E;&#x73B0;&#xFF0C;&#x9488;&#x5BF9;<code>SpringBoot2</code>&#xFF0C;&#x4E00;&#x822C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#x662F;<code>tomcat</code>&#x5BB9;&#x5668;&#xFF0C; &#x6211;&#x4EEC;&#x53EF;&#x5B9A;&#x4F4D;&#x5230;<code>ApplicationContext</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getMimeType</span><span class="params">(String file)</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (file == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> period = file.lastIndexOf(<span class="string">&apos;.&apos;</span>);</span><br><span class="line">    <span class="keyword">if</span> (period &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    String extension = file.substring(period + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (extension.length() &lt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">//&#x6B64;&#x5904;context&#x65E2;&#x662F;&#x4E00;&#x5F00;&#x59CB;&#x63D0;&#x5230;&#x7684;StandardContext&#xFF0C;&#x5373;&#x53EF;&#x5F97;&#x5230;&#x4E0A;&#x6587;&#x4E2D;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x6DFB;&#x52A0;&#x7684;mimetype</span></span><br><span class="line">    <span class="keyword">return</span> context.findMimeMapping(extension);</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x6700;&#x540E;&#x53EF;&#x4EE5;&#x770B;&#x5230;<code>response</code>&#x7684;<code>ContentType</code>&#x548C;<code>mediaType</code>&#x606F;&#x606F;&#x76F8;&#x5173;&#x3002;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setHeaders</span><span class="params">(HttpServletResponse response, Resource resource, @Nullable MediaType mediaType)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IOException </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> length = resource.contentLength();</span><br><span class="line">    <span class="keyword">if</span> (length &gt; Integer.MAX_VALUE) {</span><br><span class="line">        response.setContentLengthLong(length);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">        response.setContentLength((<span class="keyword">int</span>) length);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mediaType != <span class="keyword">null</span>) {</span><br><span class="line">        <span class="comment">//&#x5B9E;&#x9645;&#x8FD4;&#x56DE;content-Type&#x548C;MediaType&#x6709;&#x5173;</span></span><br><span class="line">        response.setContentType(mediaType.toString());</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (resource <span class="keyword">instanceof</span> HttpResource) {</span><br><span class="line">        HttpHeaders resourceHeaders = ((HttpResource) resource).getResponseHeaders();</span><br><span class="line">        resourceHeaders.forEach((headerName, headerValues) -&gt; {</span><br><span class="line">            <span class="keyword">boolean</span> first = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">for</span> (String headerValue : headerValues) {</span><br><span class="line">                <span class="keyword">if</span> (first) {</span><br><span class="line">                    response.setHeader(headerName, headerValue);</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">else</span> {</span><br><span class="line">                    response.addHeader(headerName, headerValue);</span><br><span class="line">                }</span><br><span class="line">                first = <span class="keyword">false</span>;</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line">    response.setHeader(HttpHeaders.ACCEPT_RANGES, <span class="string">&quot;bytes&quot;</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://leaderli.github.io/2019/08/01/vscode相关/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lijun">
      <meta itemprop="description" content="与其感慨路难行，不如马上就出发">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大狗哥传奇">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/08/01/vscode相关/" class="post-title-link" itemprop="url">vscode相关</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-08-01 21:48:45" itemprop="dateCreated datePublished" datetime="2019-08-01T21:48:45+08:00">2019-08-01</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-11-13 17:33:07" itemprop="dateModified" datetime="2019-11-13T17:33:07+08:00">2019-11-13</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/vscode/" itemprop="url" rel="index"><span itemprop="name">vscode</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="vim-&#x81EA;&#x52A8;&#x5207;&#x6362;&#x8F93;&#x5165;&#x6CD5;">vim &#x81EA;&#x52A8;&#x5207;&#x6362;&#x8F93;&#x5165;&#x6CD5;</h2>
<p>&#x5B89;&#x88C5;&#x8F6F;&#x4EF6;</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -Ls https://raw.githubusercontent.com/daipeihust/im-select/master/install_mac.sh | sh</span><br></pre></td></tr></table></figure>
<p>&#x8F6F;&#x4EF6;&#x4F1A;&#x9ED8;&#x8BA4;&#x5B89;&#x88C5;&#x5230;&#x76EE;&#x5F55;<code>/user/local/bin/</code>&#x4E0B;, &#x65E0;&#x53C2;&#x6570;&#x6267;&#x884C;&#x65F6;&#x5C31;&#x4F1A;&#x8F93;&#x51FA;&#x9ED8;&#x8BA4;&#x8F93;&#x5165;&#x6CD5;&#x7684;&#x5B57;&#x7B26;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/bin$ im-select</span><br><span class="line">com.apple.keylayout.ABC</span><br></pre></td></tr></table></figure>
<p>&#x6253;&#x5F00;<code>vscode</code>&#x7684;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x6587;&#x4EF6;<code>setting.json</code>,&#x65B0;&#x589E;&#x5982;&#x4E0B;&#x914D;&#x7F6E;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;vim.autoSwitchInputMethod.enable&quot;: true,</span><br><span class="line">&quot;vim.autoSwitchInputMethod.defaultIM&quot;: &quot;com.apple.keylayout.ABC&quot;,</span><br><span class="line">&quot;vim.autoSwitchInputMethod.obtainIMCmd&quot;: &quot;/usr/local/bin/im-select&quot;,</span><br><span class="line">&quot;vim.autoSwitchInputMethod.switchIMCmd&quot;: &quot;/usr/local/bin/im-select {im}&quot;</span><br></pre></td></tr></table></figure>
<p>&#x5176;&#x4E2D;&#x9ED8;&#x8BA4;<code>defaultIM</code>&#x7684;&#x503C;&#x4E3A;&#x4F60;&#x9700;&#x8981;&#x81EA;&#x52A8;&#x5207;&#x6362;&#x7684;&#x9ED8;&#x8BA4;&#x8F93;&#x5165;&#x6CD5;</p>
<h2 id="&#x4FDD;&#x5B58;&#x540E;&#x81EA;&#x52A8;&#x8FD0;&#x884C;">&#x4FDD;&#x5B58;&#x540E;&#x81EA;&#x52A8;&#x8FD0;&#x884C;</h2>
<p>1.&#x5B89;&#x88C5;<a href="https://marketplace.visualstudio.com/items?itemName=formulahendry.code-runner" target="_blank" rel="noopener">Code Runner</a></p>
<p>&#x5728;<code>settings.json</code>&#x4E2D;&#x914D;&#x7F6E;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;code-runner.executorMapByFileExtension&quot;: {</span><br><span class="line">    &quot;.scm&quot;: &quot;scheme --quiet&lt;&quot;,</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x6709;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;&#x914D;&#x7F6E;&#x624D;&#x751F;&#x6548;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;code-runner.executorMap&quot;: {</span><br><span class="line">    &quot;scheme&quot;: &quot;scheme --quiet&lt; \&quot;$dir$fileName\&quot;&quot;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>2.&#x5B89;&#x88C5;<a href="https://marketplace.visualstudio.com/items?itemName=pucelle.run-on-save" target="_blank" rel="noopener">Run on Save</a></p>
<p>&#x5728;<code>settings.json</code>&#x4E2D;&#x914D;&#x7F6E;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&quot;runOnSave.commands&quot;: [</span><br><span class="line">    {</span><br><span class="line">        <span class="attr">&quot;match&quot;</span>: <span class="string">&quot;\\.scm$&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;scheme --quiet &lt; ${file}&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;runIn&quot;</span>: <span class="string">&quot;backend&quot;</span></span><br><span class="line">    }</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>&#x5177;&#x4F53;&#x8BE6;&#x60C5;&#x914D;&#x7F6E;&#x53EF;&#x53C2;&#x8003;&#x63D2;&#x4EF6;&#x7684;&#x6587;&#x6863;</p>
<h2 id="&#x6700;&#x8FD1;&#x6253;&#x5F00;&#x6587;&#x4EF6;">&#x6700;&#x8FD1;&#x6253;&#x5F00;&#x6587;&#x4EF6;</h2>
<p>open recent file <code>&#x2303; R</code></p>
<h2 id="&#x62EC;&#x53F7;&#x5339;&#x914D;&#x8272;">&#x62EC;&#x53F7;&#x5339;&#x914D;&#x8272;</h2>
<p>&#x4F7F;&#x7528; <a href="https://marketplace.visualstudio.com/items?itemName=CoenraadS.bracket-pair-colorizer-2" target="_blank" rel="noopener">Bracket Pair Colorizer2</a></p>
<p>&#x989C;&#x8272;&#x65B9;&#x6848;(&#x4F7F;&#x7528;&#x9ED1;&#x8272;&#x4E3B;&#x9898;)&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x5728;<code>settings.json</code>&#x4E2D;&#x914D;&#x7F6E;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&quot;bracket-pair-colorizer-2.colors&quot;: [</span><br><span class="line"></span><br><span class="line">        &quot;#289CF4&quot;,</span><br><span class="line">        &quot;#FED02F&quot;,</span><br><span class="line">        &quot;#2CDD18&quot;,</span><br><span class="line">        &quot;#FF5FFF&quot;,</span><br><span class="line">        &quot;#D10000&quot;,</span><br><span class="line">        &quot;#D05355&quot;,</span><br><span class="line">        &quot;#fff&quot;,</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>
<h2 id="&#x662F;&#x5426;&#x663E;&#x793A;&#x4FA7;&#x8FB9;&#x680F;">&#x662F;&#x5426;&#x663E;&#x793A;&#x4FA7;&#x8FB9;&#x680F;</h2>
<p><code>Toggle activitiy Bar Visibility</code> &#x5E26;&#x56FE;&#x6807;&#x7684;&#x4FA7;&#x8FB9;&#x5DE5;&#x5177;&#x680F;</p>
<p><code>Toggle side Bar Visibility</code>&#x5FEB;&#x6377;&#x952E;<code>&#x2318;b</code> &#x5177;&#x4F53;&#x5DE5;&#x5177;&#x680F;&#x7684;&#x5B9E;&#x9645;&#x5185;&#x5BB9;</p>
<h2 id="&#x5408;&#x5E76;&#x5F53;&#x524D;&#x884C;">&#x5408;&#x5E76;&#x5F53;&#x524D;&#x884C;</h2>
<p>join line <code>&#x2303; R</code></p>
<h2 id="&#x81EA;&#x5B9A;&#x4E49;&#x4EE3;&#x7801;&#x7247;&#x6BB5;">&#x81EA;&#x5B9A;&#x4E49;&#x4EE3;&#x7801;&#x7247;&#x6BB5;</h2>
<ol type="1">
<li><code>Configure user Snippets</code></li>
<li>&#x9009;&#x62E9;&#x751F;&#x6548;&#x7684;&#x8BED;&#x8A00; 3 &#x8FDB;&#x884C;&#x914D;&#x7F6E;</li>
</ol>
<p>scope &#x4E0D;&#x662F;&#x6587;&#x4EF6;&#x6269;&#x5C55;&#x540D;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&quot;Print to console&quot;: {</span><br><span class="line">    &quot;scope&quot;: &quot;scheme&quot;,</span><br><span class="line">    &quot;prefix&quot;: &quot;log&quot;,</span><br><span class="line">    &quot;body&quot;: [</span><br><span class="line">        &quot;(write-line ($0))&quot;,</span><br><span class="line">    ],</span><br><span class="line">    &quot;description&quot;: &quot;Log output to console&quot;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h2 id="markdown&#x56FE;&#x7247;&#x63D2;&#x4EF6;"><code>markdown</code>&#x56FE;&#x7247;&#x63D2;&#x4EF6;</h2>
<p>&#x4F7F;&#x7528;<a href="https://marketplace.visualstudio.com/items?itemName=mushan.vscode-paste-image" target="_blank" rel="noopener">Paste Image</a></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> &quot;pasteImage.namePrefix&quot;: &quot;${currentFileNameWithoutExt}_&quot;,</span><br><span class="line">&quot;pasteImage.path&quot;: &quot;${projectRoot}/source/images&quot;,</span><br><span class="line">&quot;pasteImage.basePath&quot;: &quot;${projectRoot}/source&quot;,</span><br><span class="line">&quot;pasteImage.forceUnixStyleSeparator&quot;: true,</span><br><span class="line">&quot;pasteImage.prefix&quot;: &quot;/&quot;,</span><br><span class="line">//&#x63D2;&#x5165;markdown&#x7684;&#x8BED;&#x6CD5;</span><br><span class="line">&quot;pasteImage.insertPattern&quot;: &quot;![${imageFileName}](/images/${imageFileName})&quot;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://leaderli.github.io/2019/08/01/gson使用手册/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lijun">
      <meta itemprop="description" content="与其感慨路难行，不如马上就出发">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大狗哥传奇">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/08/01/gson使用手册/" class="post-title-link" itemprop="url">gson使用手册</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-08-01 21:22:36" itemprop="dateCreated datePublished" datetime="2019-08-01T21:22:36+08:00">2019-08-01</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-28 23:24:50" itemprop="dateModified" datetime="2019-08-28T23:24:50+08:00">2019-08-28</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/手册/" itemprop="url" rel="index"><span itemprop="name">手册</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="&#x57FA;&#x672C;&#x7C7B;&#x578B;">&#x57FA;&#x672C;&#x7C7B;&#x578B;</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Serialization</span></span><br><span class="line">Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">gson.toJson(<span class="number">1</span>);            <span class="comment">// ==&gt; 1</span></span><br><span class="line">gson.toJson(<span class="string">&quot;abcd&quot;</span>);       <span class="comment">// ==&gt; &quot;abcd&quot;</span></span><br><span class="line">gson.toJson(<span class="keyword">new</span> Long(<span class="number">10</span>)); <span class="comment">// ==&gt; 10</span></span><br><span class="line"><span class="keyword">int</span>[] values = { <span class="number">1</span> };</span><br><span class="line">gson.toJson(values);       <span class="comment">// ==&gt; [1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Deserialization</span></span><br><span class="line"><span class="keyword">int</span> one = gson.fromJson(<span class="string">&quot;1&quot;</span>, <span class="keyword">int</span>.class);</span><br><span class="line">Integer one = gson.fromJson(<span class="string">&quot;1&quot;</span>, Integer.class);</span><br><span class="line">Long one = gson.fromJson(<span class="string">&quot;1&quot;</span>, Long.class);</span><br><span class="line">Boolean <span class="keyword">false</span> = gson.fromJson(<span class="string">&quot;false&quot;</span>, Boolean.class);</span><br><span class="line">String str = gson.fromJson(<span class="string">&quot;\&quot;abc\&quot;&quot;</span>, String.class);</span><br><span class="line">String[] anotherStr = gson.fromJson(<span class="string">&quot;[\&quot;abc\&quot;]&quot;</span>, String[].class);</span><br></pre></td></tr></table></figure>
<h2 id="&#x7C7B;">&#x7C7B;</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BagOfPrimitives</span> </span>{</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> value1 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">private</span> String value2 = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">int</span> value3 = <span class="number">3</span>;</span><br><span class="line">  BagOfPrimitives() {</span><br><span class="line">    <span class="comment">// no-args constructor</span></span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// Serialization</span></span><br><span class="line">BagOfPrimitives obj = <span class="keyword">new</span> BagOfPrimitives();</span><br><span class="line">Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">String json = gson.toJson(obj);  </span><br><span class="line"></span><br><span class="line"><span class="comment">// ==&gt; json is {&quot;value1&quot;:1,&quot;value2&quot;:&quot;abc&quot;}</span></span><br></pre></td></tr></table></figure>
<p>&#x6CE8;&#x610F;&#x4E8B;&#x9879;</p>
<ol type="1">
<li>&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x63A8;&#x8350;&#x4F7F;&#x7528;<code>private</code></li>
<li>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x88AB;<code>transient</code>&#x4FEE;&#x9970;&#x7684;&#x5C5E;&#x6027;&#x4F1A;&#x88AB;&#x5FFD;&#x7565;</li>
<li>&#x5E8F;&#x5217;&#x5316;&#x65F6;&#x4E3A;&#x503C;<code>null</code>&#x7684;&#x5C5E;&#x6027;&#x5C06;&#x4F1A;&#x88AB;&#x5FFD;&#x7565;</li>
<li>&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x65F6;&#xFF0C;&#x503C;<code>null</code>&#x7684;&#x5C5E;&#x6027;&#x5C06;&#x4F1A;&#x88AB;&#x8D4B;&#x503C;&#x4E3A;<code>&#x96F6;&#x503C;</code></li>
</ol>
<h2 id="&#x6570;&#x7EC4;">&#x6570;&#x7EC4;</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line"><span class="keyword">int</span>[] ints = {<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>};</span><br><span class="line">String[] strings = {<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;def&quot;</span>, <span class="string">&quot;ghi&quot;</span>};</span><br><span class="line"></span><br><span class="line"><span class="comment">// Serialization</span></span><br><span class="line">gson.toJson(ints);     <span class="comment">// ==&gt; [1,2,3,4,5]</span></span><br><span class="line">gson.toJson(strings);  <span class="comment">// ==&gt; [&quot;abc&quot;, &quot;def&quot;, &quot;ghi&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Deserialization</span></span><br><span class="line"><span class="keyword">int</span>[] ints2 = gson.fromJson(<span class="string">&quot;[1,2,3,4,5]&quot;</span>, <span class="keyword">int</span>[].class);</span><br><span class="line"><span class="comment">// ==&gt; ints2 will be same as ints</span></span><br></pre></td></tr></table></figure>
<h2 id="&#x96C6;&#x5408;">&#x96C6;&#x5408;</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">Collection&lt;Integer&gt; ints = Lists.immutableList(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Serialization</span></span><br><span class="line">String json = gson.toJson(ints);  <span class="comment">// ==&gt; json is [1,2,3,4,5]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Deserialization</span></span><br><span class="line">Type collectionType = <span class="keyword">new</span> TypeToken&lt;Collection&lt;Integer&gt;&gt;(){}.getType();</span><br><span class="line">Collection&lt;Integer&gt; ints2 = gson.fromJson(json, collectionType);</span><br><span class="line"><span class="comment">// ==&gt; ints2 is same as ints</span></span><br></pre></td></tr></table></figure>
<h2 id="&#x6CDB;&#x578B;">&#x6CDB;&#x578B;</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>&lt;<span class="title">T</span>&gt; </span>{</span><br><span class="line">  T value;</span><br><span class="line">}</span><br><span class="line">Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line"></span><br><span class="line">Foo&lt;Bar&gt; foo = <span class="keyword">new</span> Foo&lt;Bar&gt;();</span><br><span class="line">Type fooType = <span class="keyword">new</span> TypeToken&lt;Foo&lt;Bar&gt;&gt;() {}.getType();</span><br><span class="line">gson.toJson(foo, fooType);</span><br><span class="line"></span><br><span class="line">gson.fromJson(json, fooType);</span><br></pre></td></tr></table></figure>
<p>&#x4F7F;&#x7528;<code>TypeToken</code>&#x53EF;&#x6307;&#x5B9A;&#x6CDB;&#x578B;</p>
<h2 id="&#x5185;&#x7F6E;&#x89E3;&#x6790;&#x5668;">&#x5185;&#x7F6E;&#x89E3;&#x6790;&#x5668;</h2>
<p><code>java.net.URL</code>&#x53EF;&#x4EE5;&#x5339;&#x914D;&#x5982;&#x4E0B;&#x683C;&#x5F0F;&#x7684;&#x503C;<code>&quot;https://github.com/google/gson/&quot;</code> <code>java.net.URI</code> &#x53EF;&#x4EE5;&#x5339;&#x914D;&#x5982;&#x4E0B;&#x683C;&#x5F0F;&#x7684;&#x503C;<code>&quot;/google/gson/&quot;</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">String json = <span class="string">&quot;{\&quot;url\&quot;: \&quot;https://github.com/google/gson/\&quot;,\&quot;uri\&quot;: \&quot;/google/gson/\&quot;}&quot;</span>;</span><br><span class="line">TestUrl testUrl = gson.fromJson(json, TestUrl.class);</span><br><span class="line"><span class="comment">// toString --&gt;  GsonTest.TestUrl(url=https://github.com/google/gson/, uri=/google/gson/)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TestUrl</span></span>{</span><br><span class="line">    <span class="keyword">private</span> URL url;</span><br><span class="line">    <span class="keyword">private</span> URI uri;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h2 id="&#x81EA;&#x5B9A;&#x4E49;&#x5E8F;&#x5217;&#x5316;&#x4E0E;&#x53CD;&#x5E8F;&#x5217;&#x5316;">&#x81EA;&#x5B9A;&#x4E49;&#x5E8F;&#x5217;&#x5316;&#x4E0E;&#x53CD;&#x5E8F;&#x5217;&#x5316;</h2>
<p>&#x9700;&#x8981;&#x5E8F;&#x5217;&#x5316;&#x7684;&#x7C7B;<code>UserBean</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserBean</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5E8F;&#x5217;&#x5316;&#x5904;&#x7406;&#x5668;&#xFF0C;&#x6CDB;&#x578B;&#x4E3A;<code>UserBean</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserJsonSerializer</span> <span class="keyword">implements</span> <span class="title">JsonSerializer</span>&lt;<span class="title">UserBean</span>&gt;</span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JsonElement <span class="title">serialize</span><span class="params">(UserBean src, Type typeOfSrc, JsonSerializationContext context)</span> </span>{</span><br><span class="line">        <span class="comment">//src &#x5373;&#x662F;&#x5F85;&#x5E8F;&#x5217;&#x5316;&#x7684;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;</span></span><br><span class="line">        JsonObject userJson= <span class="keyword">new</span> JsonObject();</span><br><span class="line">        userJson.addProperty(<span class="string">&quot;__name__&quot;</span>,src.getName());</span><br><span class="line">        <span class="keyword">return</span> userJson;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x5904;&#x7406;&#x5668;&#xFF0C;&#x6CDB;&#x578B;&#x4E3A;<code>UserBean</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserJsonDeserializer</span> <span class="keyword">implements</span> <span class="title">JsonDeserializer</span>&lt;<span class="title">UserBean</span>&gt;</span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserBean <span class="title">deserialize</span><span class="params">(JsonElement json, Type typeOfT, JsonDeserializationContext context)</span> <span class="keyword">throws</span> JsonParseException </span>{</span><br><span class="line">        UserBean userBean = <span class="keyword">new</span> UserBean();</span><br><span class="line">        <span class="comment">//json &#x5373;&#x4E3A;&#x5F85;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x751F;&#x6210;&#x7684;json&#x5BF9;&#x8C61;</span></span><br><span class="line">        JsonObject asJsonObject = json.getAsJsonObject();</span><br><span class="line">        <span class="keyword">if</span>(asJsonObject.has(<span class="string">&quot;__name__&quot;</span>)){</span><br><span class="line">            userBean.setName(String.valueOf(asJsonObject.get(<span class="string">&quot;__name__&quot;</span>)));</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> userBean;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;&#xFF0C;&#x6CE8;&#x518C;<code>UserBean</code>&#x7684;<code>TypeToken</code>&#x7684;&#x5E8F;&#x5217;&#x5316;&#x4E0E;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x5904;&#x7406;&#x5668;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GsonBuilder gsonBuilder = <span class="keyword">new</span> GsonBuilder();</span><br><span class="line">Type type= <span class="keyword">new</span> TypeToken&lt;UserBean&gt;() {}.getType();</span><br><span class="line">gsonBuilder.registerTypeAdapter(type,<span class="keyword">new</span> UserJsonSerializer());</span><br><span class="line">gsonBuilder.registerTypeAdapter(type,<span class="keyword">new</span> UserJsonDeserializer());</span><br><span class="line">Gson gson = gsonBuilder.create();</span><br><span class="line">UserBean userBean = <span class="keyword">new</span> UserBean();</span><br><span class="line">userBean.setName(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">String json = gson.toJson(userBean);</span><br><span class="line"><span class="comment">// {&quot;__name__&quot;:&quot;123&quot;}</span></span><br><span class="line">userBean = gson.fromJson(json, UserBean.class);</span><br><span class="line"><span class="comment">//UserBean(name=&quot;123&quot;)</span></span><br></pre></td></tr></table></figure>
<h2 id="&#x4F18;&#x5316;&#x6253;&#x5370;">&#x4F18;&#x5316;&#x6253;&#x5370;</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Gson gson = <span class="keyword">new</span> GsonBuilder().setPrettyPrinting().create();</span><br><span class="line">Person person= <span class="keyword">new</span> Person();</span><br><span class="line">person.setAge(<span class="number">1</span>);</span><br><span class="line">person.setName(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">System.out.println(gson.toJson(person))</span><br></pre></td></tr></table></figure>
<p>&#x6253;&#x5370;&#x7ED3;&#x679C;&#x5982;&#x4E0B;</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;hello&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;age&quot;</span>: <span class="number">1</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://leaderli.github.io/2019/07/31/mybatis入门/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lijun">
      <meta itemprop="description" content="与其感慨路难行，不如马上就出发">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大狗哥传奇">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/31/mybatis入门/" class="post-title-link" itemprop="url">mybatis入门</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-31 23:01:52" itemprop="dateCreated datePublished" datetime="2019-07-31T23:01:52+08:00">2019-07-31</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-13 22:10:44" itemprop="dateModified" datetime="2019-08-13T22:10:44+08:00">2019-08-13</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/mybatis/" itemprop="url" rel="index"><span itemprop="name">mybatis</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="&#x7248;&#x672C;&#x8BF4;&#x660E;">&#x7248;&#x672C;&#x8BF4;&#x660E;</h2>
<p><code>jdk</code>:1.8.0_131 <code>springboot</code>:2.1.6.RELEAS <code>maven</code>:3.6.1 <code>database</code>:mysql-5.7.1 <code>mybatis</code>:3.5.2 <code>lombok&#x63D2;&#x4EF6;</code></p>
<h2 id="&#x6982;&#x8FF0;">&#x6982;&#x8FF0;</h2>
<p>&#x57FA;&#x4E8E;<a href="http://www.mybatis.org/mybatis-3/getting-started.html" target="_blank" rel="noopener">&#x5B98;&#x65B9;&#x6587;&#x6863;</a>&#x7684;&#x5B66;&#x4E60;&#x7B14;&#x8BB0;&#x3002;&#x9879;&#x76EE;&#x57FA;&#x4E8E;<code>maven</code>&#x6784;&#x5EFA;,&#x9879;&#x76EE;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;<code>mybatis</code>&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x56E0;&#x6B64;&#x57FA;&#x672C;&#x4E0D;&#x4F7F;&#x7528;<code>Spring</code>&#x7684;&#x76F8;&#x5173;&#x4EE3;&#x7801;</p>
<p>&#x5EFA;&#x8868;&#x8BED;&#x53E5;&#x5982;&#x4E0B;&#xFF0C;&#x5EFA;&#x8868;&#x8BED;&#x53E5;&#x6765;&#x81EA;<a href="https://github.com/mybatis/mybatis-3/tree/master/src/test/java/org/apache/ibatis/databases/blog" target="_blank" rel="noopener">git-mybatis-3</a>&#xFF0C;&#x9488;&#x5BF9;<code>mysql</code>&#x8FDB;&#x884C;&#x90E8;&#x5206;&#x4FEE;&#x6539;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- create your own database</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="keyword">comment</span>;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> post_tag;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> tag;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> post;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> blog;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> author;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> node;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> author (</span><br><span class="line">  <span class="keyword">id</span>                <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line">  username          <span class="built_in">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="keyword">password</span>          <span class="built_in">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  email             <span class="built_in">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  bio               <span class="built_in">BLOB</span>,</span><br><span class="line">  favourite_section <span class="built_in">VARCHAR</span>(<span class="number">25</span>)</span><br><span class="line">)</span><br><span class="line">  AUTO_INCREMENT = <span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> blog (</span><br><span class="line">  <span class="keyword">id</span>        <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line">  author_id <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  title     <span class="built_in">VARCHAR</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> post (</span><br><span class="line">  <span class="keyword">id</span>         <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line">  blog_id    <span class="built_in">INT</span>,</span><br><span class="line">  author_id  <span class="built_in">INT</span>          <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  created_on <span class="built_in">TIMESTAMP</span>,</span><br><span class="line">  <span class="keyword">section</span>    <span class="built_in">VARCHAR</span>(<span class="number">25</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  subject    <span class="built_in">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="keyword">body</span>       <span class="built_in">BLOB</span>         <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  draft      <span class="built_in">INT</span>          <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (blog_id) <span class="keyword">REFERENCES</span> blog (<span class="keyword">id</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tag (</span><br><span class="line">  <span class="keyword">id</span>   <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> post_tag (</span><br><span class="line">  post_id <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  tag_id  <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (post_id, tag_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">comment</span> (</span><br><span class="line">  <span class="keyword">id</span>      <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line">  post_id <span class="built_in">INT</span>      <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="keyword">name</span>    LONGTEXT <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="keyword">comment</span> LONGTEXT <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> node (</span><br><span class="line">  <span class="keyword">id</span>        <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  parent_id <span class="built_in">INT</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> author (<span class="keyword">id</span>, username, <span class="keyword">password</span>, email, bio, favourite_section)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">101</span>, <span class="string">&apos;jim&apos;</span>, <span class="string">&apos;********&apos;</span>, <span class="string">&apos;jim@ibatis.apache.org&apos;</span>, <span class="string">&apos;&apos;</span>, <span class="string">&apos;NEWS&apos;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> author (<span class="keyword">id</span>, username, <span class="keyword">password</span>, email, bio, favourite_section)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">102</span>, <span class="string">&apos;sally&apos;</span>, <span class="string">&apos;********&apos;</span>, <span class="string">&apos;sally@ibatis.apache.org&apos;</span>, <span class="literal">NULL</span>, <span class="string">&apos;VIDEOS&apos;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> blog (<span class="keyword">id</span>, author_id, title) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">101</span>, <span class="string">&apos;Jim Business&apos;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> blog (<span class="keyword">id</span>, author_id, title) <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="number">102</span>, <span class="string">&apos;Bally Slog&apos;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> post (<span class="keyword">id</span>, blog_id, author_id, created_on, <span class="keyword">section</span>, subject, <span class="keyword">body</span>, draft) <span class="keyword">VALUES</span></span><br><span class="line">  (<span class="number">1</span>, <span class="number">1</span>, <span class="number">101</span>, <span class="string">&apos;2008-01-01 00:00:01&apos;</span>, <span class="string">&apos;NEWS&apos;</span>, <span class="string">&apos;Corn nuts&apos;</span>,</span><br><span class="line">   <span class="string">&apos;I think if I never smelled another corn nut it would be too soon...&apos;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`post`</span> (<span class="keyword">id</span>, blog_id, author_id, created_on, <span class="keyword">section</span>, subject, <span class="keyword">body</span>, draft)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="number">1</span>, <span class="number">101</span>, <span class="string">&apos;2008-01-12 00.00.00&apos;</span>, <span class="string">&apos;VIDEOS&apos;</span>, <span class="string">&apos;Paul Hogan on Toy Dogs&apos;</span>, <span class="string">&apos;That&apos;&apos;s not a dog.  THAT&apos;&apos;s a dog!&apos;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> post (<span class="keyword">id</span>, blog_id, author_id, created_on, <span class="keyword">section</span>, subject, <span class="keyword">body</span>, draft)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="number">2</span>, <span class="number">102</span>, <span class="string">&apos;2007-12-05 00.00.00&apos;</span>, <span class="string">&apos;PODCASTS&apos;</span>, <span class="string">&apos;Monster Trucks&apos;</span>, <span class="string">&apos;I think monster trucks are great...&apos;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> post (<span class="keyword">id</span>, blog_id, author_id, created_on, <span class="keyword">section</span>, subject, <span class="keyword">body</span>, draft) <span class="keyword">VALUES</span></span><br><span class="line">  (<span class="number">4</span>, <span class="number">2</span>, <span class="number">102</span>, <span class="string">&apos;2008-01-12 00.00.00&apos;</span>, <span class="string">&apos;IMAGES&apos;</span>, <span class="string">&apos;Tea Parties&apos;</span>, <span class="string">&apos;A tea party is no place to hold a business meeting...&apos;</span>,</span><br><span class="line">   <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> post (<span class="keyword">id</span>, blog_id, author_id, created_on, <span class="keyword">section</span>, subject, <span class="keyword">body</span>, draft)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">5</span>, <span class="literal">NULL</span>, <span class="number">101</span>, <span class="string">&apos;2008-01-12 00.00.00&apos;</span>, <span class="string">&apos;IMAGES&apos;</span>, <span class="string">&apos;An orphaned post&apos;</span>, <span class="string">&apos;this post is orphaned&apos;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tag (<span class="keyword">id</span>, <span class="keyword">name</span>) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&apos;funny&apos;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tag (<span class="keyword">id</span>, <span class="keyword">name</span>) <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&apos;cool&apos;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tag (<span class="keyword">id</span>, <span class="keyword">name</span>) <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">&apos;food&apos;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> post_tag (post_id, tag_id) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> post_tag (post_id, tag_id) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> post_tag (post_id, tag_id) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> post_tag (post_id, tag_id) <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> post_tag (post_id, tag_id) <span class="keyword">VALUES</span> (<span class="number">4</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">comment</span> (<span class="keyword">id</span>, post_id, <span class="keyword">name</span>, <span class="keyword">comment</span>) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">1</span>, <span class="string">&apos;troll&apos;</span>, <span class="string">&apos;I disagree and think...&apos;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">comment</span> (<span class="keyword">id</span>, post_id, <span class="keyword">name</span>, <span class="keyword">comment</span>) <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="number">1</span>, <span class="string">&apos;anonymous&apos;</span>, <span class="string">&apos;I agree and think troll is an...&apos;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">comment</span> (<span class="keyword">id</span>, post_id, <span class="keyword">name</span>, <span class="keyword">comment</span>)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">4</span>, <span class="number">2</span>, <span class="string">&apos;another&apos;</span>, <span class="string">&apos;I don not agree and still think troll is an...&apos;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">comment</span> (<span class="keyword">id</span>, post_id, <span class="keyword">name</span>, <span class="keyword">comment</span>) <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="number">3</span>, <span class="string">&apos;rider&apos;</span>, <span class="string">&apos;I prefer motorcycles to monster trucks...&apos;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> node (<span class="keyword">id</span>, parent_id) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> node (<span class="keyword">id</span>, parent_id) <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> node (<span class="keyword">id</span>, parent_id) <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> node (<span class="keyword">id</span>, parent_id) <span class="keyword">VALUES</span> (<span class="number">4</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> node (<span class="keyword">id</span>, parent_id) <span class="keyword">VALUES</span> (<span class="number">5</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> node (<span class="keyword">id</span>, parent_id) <span class="keyword">VALUES</span> (<span class="number">6</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> node (<span class="keyword">id</span>, parent_id) <span class="keyword">VALUES</span> (<span class="number">7</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure>
<p>pom&#x6587;&#x4EF6;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.li<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>mybatis</code>&#x914D;&#x7F6E;&#x6587;&#x4EF6;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta">    PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="line"><span class="meta">    &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;config.properties&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;org.mybatis.example&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;${driver}&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;${url}&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;${username}&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;${password}&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span>  <span class="attr">name</span>=<span class="string">&quot;org.mybatis.example&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="properties">properties</h2>
<p>&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5730;&#x5740;&#xFF0C;&#x6807;&#x7B7E;&#x5C5E;&#x6027;&#x503C;&#x53EF;&#x4EE5;<code>${xxx}</code>&#x53D6;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x503C;</p>
<h2 id="datasource">DataSource</h2>
<p><code>dataSource</code>&#x6807;&#x7B7E;&#x7528;&#x6765;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x6807;&#x51C6;&#x7684;<code>DataSource</code>&#x6807;&#x51C6;&#xFF0C;<code>mybatis</code>&#x5185;&#x7F6E;&#x4E86;&#x4E09;&#x79CD;&#x7C7B;&#x578B;&#x7684;<code>DataSource</code><br>
&gt;<code>type=&quot;[UNPOOLED|POOLED|JNDI]&quot;</code></p>
<h3 id="unpooled"><code>UNPOOLED</code></h3>
<p>&#x6BCF;&#x4E00;&#x6B21;&#x6570;&#x636E;&#x64CD;&#x4F5C;&#x90FD;&#x65B0;&#x5EFA;&#x3002;&#x53EF;&#x505A;&#x5982;&#x4E0B;&#x914D;&#x7F6E; &gt; <code>driver</code><br>
&gt; <code>url</code> &gt; <code>username</code><br>
&gt; <code>password</code><br>
&gt; <code>defaultTransactionIsolationLevel</code>:&#x6570;&#x636E;&#x5E93;&#x9694;&#x79BB;&#x7EA7;&#x522B;<br>
&gt; <code>defaultNetworkTimeout</code> &gt; &#x540C;&#x65F6;&#x53EF;&#x4EE5;&#x4E3A;<code>driver</code>&#x8BBE;&#x7F6E;&#x5C5E;&#x6027;<code>driver.encoding=UTF8</code></p>
<h3 id="pooled"><code>POOLED</code></h3>
<p>&#x4F7F;&#x7528;&#x8FDE;&#x63A5;&#x6C60;&#x6765;&#x7BA1;&#x7406;&#x6570;&#x636E;&#x6E90;,&#x9664;&#x4E86;<code>UNPOOLED</code>&#x7684;&#x914D;&#x7F6E;&#x8FD8;&#x53EF;&#x505A;&#x5982;&#x4E0B;&#x914D;&#x7F6E; &gt;<code>poolMaximumActiveConnections</code><br>
&gt;<code>poolMaximumIdleConnections</code><br>
&gt;<code>poolMaximumCheckoutTime</code><br>
&gt;<code>poolTimeToWait</code><br>
&gt;<code>poolMaximumLocalBadConnectionTolerance</code><br>
&gt;<code>poolPingQuery</code><br>
&gt;<code>poolPingEnabled</code><br>
&gt;<code>poolPingConnectionsNotUsedFor</code></p>
<h3 id="jndi"><code>JNDI</code></h3>
<p><code>initial_context</code> <code>data_source</code></p>
<p><code>env.</code>&#x524D;&#x7F00;&#x7684;&#x914D;&#x7F6E;&#x5C06;&#x88AB;&#x52A0;&#x8F7D;&#x5230;<code>InitialContext</code>&#x4E2D; <code>env.encoding=UTF8</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;JNDI&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;data_source&quot;</span> <span class="attr">value</span>=<span class="string">&quot;java:/comp/env/jdbc/mysql&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;">&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;</h3>
<p><code>type</code>&#x53EF;&#x6307;&#x5B9A;&#x4E3A;&#x5176;&#x4ED6;&#x5DE5;&#x5382;&#x7C7B;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;org.myproject.C3P0DataSourceFactory&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;${driver}&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;${url}&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;${username}&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;${password}&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>env.encoding=UTF8</p>
<h2 id="mappers">mappers</h2>
<p>&#x5B9A;&#x4F4D;&#x6620;&#x5C04;&#x7684;<code>SQL</code>&#x8BED;&#x53E5;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:/Users/BlogMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.example.BlogMapper&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org.mybatis.example.BlogMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span>  <span class="attr">name</span>=<span class="string">&quot;org.mybatis.example&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="typealiases">typeAliases</h2>
<p><code>mybatis</code>&#x9ED8;&#x8BA4;&#x522B;&#x540D;&#x6709;&#x5982;&#x4E0B;</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">&#x522B;&#x540D;</th>
<th style="text-align: center;">class&#x7C7B;&#x578B;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">_byte</td>
<td style="text-align: center;">byte</td>
</tr>
<tr class="even">
<td style="text-align: center;">_long</td>
<td style="text-align: center;">long</td>
</tr>
<tr class="odd">
<td style="text-align: center;">_short</td>
<td style="text-align: center;">short</td>
</tr>
<tr class="even">
<td style="text-align: center;">_int</td>
<td style="text-align: center;">int</td>
</tr>
<tr class="odd">
<td style="text-align: center;">_integer</td>
<td style="text-align: center;">int</td>
</tr>
<tr class="even">
<td style="text-align: center;">_double</td>
<td style="text-align: center;">double</td>
</tr>
<tr class="odd">
<td style="text-align: center;">_float</td>
<td style="text-align: center;">float</td>
</tr>
<tr class="even">
<td style="text-align: center;">_boolean</td>
<td style="text-align: center;">boolean</td>
</tr>
<tr class="odd">
<td style="text-align: center;">string</td>
<td style="text-align: center;">String</td>
</tr>
<tr class="even">
<td style="text-align: center;">byte</td>
<td style="text-align: center;">Byte</td>
</tr>
<tr class="odd">
<td style="text-align: center;">long</td>
<td style="text-align: center;">Long</td>
</tr>
<tr class="even">
<td style="text-align: center;">short</td>
<td style="text-align: center;">Short</td>
</tr>
<tr class="odd">
<td style="text-align: center;">int</td>
<td style="text-align: center;">Integer</td>
</tr>
<tr class="even">
<td style="text-align: center;">integer</td>
<td style="text-align: center;">Integer</td>
</tr>
<tr class="odd">
<td style="text-align: center;">double</td>
<td style="text-align: center;">Double</td>
</tr>
<tr class="even">
<td style="text-align: center;">float</td>
<td style="text-align: center;">Float</td>
</tr>
<tr class="odd">
<td style="text-align: center;">boolean</td>
<td style="text-align: center;">Boolean</td>
</tr>
<tr class="even">
<td style="text-align: center;">date</td>
<td style="text-align: center;">Date</td>
</tr>
<tr class="odd">
<td style="text-align: center;">decimal</td>
<td style="text-align: center;">BigDecimal</td>
</tr>
<tr class="even">
<td style="text-align: center;">bigdecimal</td>
<td style="text-align: center;">BigDecimal</td>
</tr>
<tr class="odd">
<td style="text-align: center;">object</td>
<td style="text-align: center;">Object</td>
</tr>
<tr class="even">
<td style="text-align: center;">map</td>
<td style="text-align: center;">Map</td>
</tr>
<tr class="odd">
<td style="text-align: center;">hashmap</td>
<td style="text-align: center;">HashMap</td>
</tr>
<tr class="even">
<td style="text-align: center;">list</td>
<td style="text-align: center;">List</td>
</tr>
<tr class="odd">
<td style="text-align: center;">arraylist</td>
<td style="text-align: center;">ArrayList</td>
</tr>
<tr class="even">
<td style="text-align: center;">collection</td>
<td style="text-align: center;">Collection</td>
</tr>
<tr class="odd">
<td style="text-align: center;">iterator</td>
<td style="text-align: center;">Iterator</td>
</tr>
</tbody>
</table>
<p>&#x53EF;&#x6307;&#x5B9A;&#x5176;&#x4ED6;&#x522B;&#x540D;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;org.mybatis.example.Blog&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;blog&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;org.mybatis.example&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&#x522B;&#x540D;&#x53EF;&#x4F9B;<code>resultType</code>&#x6216;<code>parameterType</code>&#x4F7F;&#x7528;</p>
<h2 id="typehandlers">typeHandlers</h2>
<p>&#x6BCF;&#x5F53;MyBatis&#x5728;PreparedStatement&#x4E0A;&#x8BBE;&#x7F6E;&#x53C2;&#x6570;&#x6216;&#x4ECE;ResultSet&#x4E2D;&#x68C0;&#x7D22;&#x503C;&#x65F6;&#xFF0C;&#x90FD;&#x4F1A;&#x4F7F;&#x7528;TypeHandler&#x4EE5;&#x9002;&#x5408;Java&#x7C7B;&#x578B;&#x7684;&#x65B9;&#x5F0F;&#x68C0;&#x7D22;&#x503C;&#x3002; &#x4E0B;&#x8868;&#x63CF;&#x8FF0;&#x4E86;&#x9ED8;&#x8BA4;&#x7684;TypeHandlers&#x3002;</p>
<table>
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Type Handler</th>
<th style="text-align: left;">java Types</th>
<th style="text-align: left;">JDBC Types</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">BooleanTypeHandler</td>
<td style="text-align: left;">java.lang.Boolean, boolean</td>
<td style="text-align: left;">Any compatible BOOLEAN</td>
</tr>
<tr class="even">
<td style="text-align: left;">ByteTypeHandler</td>
<td style="text-align: left;">java.lang.Byte, byte</td>
<td style="text-align: left;">Any compatible NUMERIC or BYTE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ShortTypeHandler</td>
<td style="text-align: left;">java.lang.Short, short</td>
<td style="text-align: left;">Any compatible NUMERIC or SMALLINT</td>
</tr>
<tr class="even">
<td style="text-align: left;">IntegerTypeHandler</td>
<td style="text-align: left;">java.lang.Integer, int</td>
<td style="text-align: left;">Any compatible NUMERIC or INTEGER</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LongTypeHandler</td>
<td style="text-align: left;">java.lang.Long, long</td>
<td style="text-align: left;">Any compatible NUMERIC or BIGINT</td>
</tr>
<tr class="even">
<td style="text-align: left;">FloatTypeHandler</td>
<td style="text-align: left;">java.lang.Float, float</td>
<td style="text-align: left;">Any compatible NUMERIC or FLOAT</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DoubleTypeHandler</td>
<td style="text-align: left;">java.lang.Double, double</td>
<td style="text-align: left;">Any compatible NUMERIC or DOUBLE</td>
</tr>
<tr class="even">
<td style="text-align: left;">BigDecimalTypeHandler</td>
<td style="text-align: left;">java.math.BigDecimal</td>
<td style="text-align: left;">Any compatible NUMERIC or DECIMAL</td>
</tr>
<tr class="odd">
<td style="text-align: left;">StringTypeHandler</td>
<td style="text-align: left;">java.lang.String</td>
<td style="text-align: left;">CHAR, VARCHAR</td>
</tr>
<tr class="even">
<td style="text-align: left;">ClobReaderTypeHandler</td>
<td style="text-align: left;">java.io.Reader</td>
<td style="text-align: left;">-</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ClobTypeHandler</td>
<td style="text-align: left;">java.lang.String</td>
<td style="text-align: left;">CLOB, LONGVARCHAR</td>
</tr>
<tr class="even">
<td style="text-align: left;">NStringTypeHandler</td>
<td style="text-align: left;">java.lang.String</td>
<td style="text-align: left;">NVARCHAR, NCHAR</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NClobTypeHandler</td>
<td style="text-align: left;">java.lang.String</td>
<td style="text-align: left;">NCLOB</td>
</tr>
<tr class="even">
<td style="text-align: left;">BlobInputStreamTypeHandler</td>
<td style="text-align: left;">java.io.InputStream</td>
<td style="text-align: left;">-</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ByteArrayTypeHandler</td>
<td style="text-align: left;">byte[]</td>
<td style="text-align: left;">Any compatible byte stream type</td>
</tr>
<tr class="even">
<td style="text-align: left;">BlobTypeHandler</td>
<td style="text-align: left;">byte[]</td>
<td style="text-align: left;">BLOB, LONGVARBINARY</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DateTypeHandler</td>
<td style="text-align: left;">java.util.Date</td>
<td style="text-align: left;">TIMESTAMP</td>
</tr>
<tr class="even">
<td style="text-align: left;">DateOnlyTypeHandler</td>
<td style="text-align: left;">java.util.Date</td>
<td style="text-align: left;">DATE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TimeOnlyTypeHandler</td>
<td style="text-align: left;">java.util.Date</td>
<td style="text-align: left;">TIME</td>
</tr>
<tr class="even">
<td style="text-align: left;">SqlTimestampTypeHandler</td>
<td style="text-align: left;">java.sql.Timestamp</td>
<td style="text-align: left;">TIMESTAMP</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SqlDateTypeHandler</td>
<td style="text-align: left;">java.sql.Date</td>
<td style="text-align: left;">DATE</td>
</tr>
<tr class="even">
<td style="text-align: left;">SqlTimeTypeHandler</td>
<td style="text-align: left;">java.sql.Time</td>
<td style="text-align: left;">TIME</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ObjectTypeHandler</td>
<td style="text-align: left;">Any OTHER, or unspecified</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">EnumTypeHandler</td>
<td style="text-align: left;">Enumeration Type</td>
<td style="text-align: left;">VARCHAR any string compatible type, as the code is stored (not index).</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EnumOrdinalTypeHandler</td>
<td style="text-align: left;">Enumeration Type</td>
<td style="text-align: left;">Any compatible NUMERIC or DOUBLE, as the position is stored (not the code itself).</td>
</tr>
<tr class="even">
<td style="text-align: left;">SqlxmlTypeHandler</td>
<td style="text-align: left;">java.lang.String</td>
<td style="text-align: left;">SQLXML</td>
</tr>
<tr class="odd">
<td style="text-align: left;">InstantTypeHandler</td>
<td style="text-align: left;">java.time.Instant</td>
<td style="text-align: left;">TIMESTAMP</td>
</tr>
<tr class="even">
<td style="text-align: left;">LocalDateTimeTypeHandler</td>
<td style="text-align: left;">java.time.LocalDateTime</td>
<td style="text-align: left;">TIMESTAMP</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LocalDateTypeHandler</td>
<td style="text-align: left;">java.time.LocalDate</td>
<td style="text-align: left;">DATE</td>
</tr>
<tr class="even">
<td style="text-align: left;">LocalTimeTypeHandler</td>
<td style="text-align: left;">java.time.LocalTime</td>
<td style="text-align: left;">TIME</td>
</tr>
<tr class="odd">
<td style="text-align: left;">OffsetDateTimeTypeHandler</td>
<td style="text-align: left;">java.time.OffsetDateTime</td>
<td style="text-align: left;">TIMESTAMP</td>
</tr>
<tr class="even">
<td style="text-align: left;">OffsetTimeTypeHandler</td>
<td style="text-align: left;">java.time.OffsetTime</td>
<td style="text-align: left;">TIME</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ZonedDateTimeTypeHandler</td>
<td style="text-align: left;">java.time.ZonedDateTime</td>
<td style="text-align: left;">TIMESTAMP</td>
</tr>
<tr class="even">
<td style="text-align: left;">YearTypeHandler</td>
<td style="text-align: left;">java.time.Year</td>
<td style="text-align: left;">INTEGER</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MonthTypeHandler</td>
<td style="text-align: left;">java.time.Month</td>
<td style="text-align: left;">INTEGER</td>
</tr>
<tr class="even">
<td style="text-align: left;">YearMonthTypeHandler</td>
<td style="text-align: left;">java.time.YearMonth</td>
<td style="text-align: left;">VARCHAR or LONGVARCHAR</td>
</tr>
<tr class="odd">
<td style="text-align: left;">JapaneseDateTypeHandler</td>
<td style="text-align: left;">java.time.chrono.JapaneseDate</td>
<td style="text-align: left;">DATE</td>
</tr>
</tbody>
</table>
<p>&#x4F60;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7EE7;&#x627F;<code>org.apache.ibatis.type.TypeHandler</code>&#x6216;&#x8005;&#x4F7F;&#x7528;<code>org.apache.ibatis.type.BaseTypeHandler</code>&#x6765;&#x4F7F;&#x7528;&#x975E;&#x6807;&#x51C6;&#x7684;<code>TypeHandler</code></p>
<p>&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;<code>typeHandlers</code>&#x4E2D;&#x7684;<code>typeHandler</code>&#x6807;&#x7B7E;&#x4E2D;&#x914D;&#x7F6E;<code>jdbcType</code>,&#x53EF;&#x6307;&#x5B9A;<code>sql</code>&#x8868;&#x5B57;&#x6BB5;&#x7C7B;&#x578B;&#xFF0C;&#x82E5;&#x5B9E;&#x9645;<code>java</code>&#x7C7B;&#x6CE8;&#x89E3;&#x4E86;<code>@MappedJdbcTypes</code>&#xFF0C;&#x4F1A;&#x65E0;&#x89C6;&#x914D;&#x7F6E;&#x6587;&#x4EF6;<br>
&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;<code>typeHandlers</code>&#x4E2D;&#x7684;<code>typeHandler</code>&#x6807;&#x7B7E;&#x4E2D;&#x914D;&#x7F6E;<code>javaType</code>,&#x53EF;&#x6307;&#x5B9A;<code>javaBean</code>&#x7C7B;&#x578B;&#xFF0C;&#x82E5;&#x5B9E;&#x9645;<code>java</code>&#x7C7B;&#x6CE8;&#x89E3;&#x4E86;<code>@MappedTypes</code>&#xFF0C;&#x4F1A;&#x65E0;&#x89C6;&#x914D;&#x7F6E;&#x6587;&#x4EF6;<br>
&#x793A;&#x4F8B;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.mybatis.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.BaseTypeHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.JdbcType;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.MappedJdbcTypes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.CallableStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* includeNullJdbcType=true&#x8868;&#x793A;&#x5F53;sql&#x5B57;&#x6BB5;&#x7C7B;&#x578B;&#x672A;&#x77E5;&#x4E5F;&#x53EF;&#x4F7F;&#x7528;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@MappedJdbcTypes</span>(value=JdbcType.VARCHAR,includeNullJdbcType=<span class="keyword">true</span>)</span><br><span class="line"><span class="meta">@MappedTypes</span>(String.class)  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleTypeHandler</span> <span class="keyword">extends</span> <span class="title">BaseTypeHandler</span>&lt;<span class="title">String</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNonNullParameter</span><span class="params">(PreparedStatement ps, <span class="keyword">int</span> i, String parameter, JdbcType jdbcType)</span> <span class="keyword">throws</span> SQLException </span>{</span><br><span class="line">        ps.setString(i, parameter+<span class="string">&quot;_sql&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNullableResult</span><span class="params">(ResultSet rs, String columnName)</span> <span class="keyword">throws</span> SQLException </span>{</span><br><span class="line">        <span class="keyword">return</span> rs.getString(columnName)+<span class="string">&quot;_java&quot;</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNullableResult</span><span class="params">(ResultSet rs, <span class="keyword">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException </span>{</span><br><span class="line">        <span class="keyword">return</span> rs.getString(columnIndex)+<span class="string">&quot;:java&quot;</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNullableResult</span><span class="params">(CallableStatement cs, <span class="keyword">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException </span>{</span><br><span class="line">        <span class="keyword">return</span> cs.getString(columnIndex)+<span class="string">&quot;#java&quot;</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5728;<code>mybatis</code>&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x82E5;&#x914D;&#x7F6E;&#x4E86;<code>&lt;typehandlers&gt;</code>&#x5C06;&#x4F1A;&#x66FF;&#x6362;&#x9ED8;&#x8BA4;&#x7684;&#x6570;&#x636E;&#x5E93;&#x7C7B;&#x578B;&#x4E3A;<code>VARCHAR</code>&#xFF0C;<code>java</code>&#x7C7B;&#x578B;&#x4E3A;<code>java.lang.String</code>&#x7684;&#x8F6C;&#x6362;&#x5904;&#x7406;&#x5668;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.mybatis.example.ExampleTypeHandler&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &#x626B;&#x63CF;package&#x76EE;&#x5F55;&#x4E0B;&#x6240;&#x6709;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x5668;--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;org.mybatis.example&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&#x4E5F;&#x53EF;&#x4E34;&#x65F6;&#x6307;&#x5B9A;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;blogMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;blog&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>  <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;title&quot;</span> <span class="attr">typeHandler</span>=<span class="string">&quot;exampleTypeHandler&quot;</span> <span class="attr">property</span>=<span class="string">&quot;title&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&#x53EF;&#x4F7F;&#x7528;&#x6CDB;&#x578B;&#xFF0C;&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x6587;&#x4EF6;<code>typeHandler</code>&#x7684;<code>javaType</code>&#x89C9;&#x5F97;&#x5904;&#x7406;&#x7684;<code>java</code>&#x7C7B;&#x578B;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericTypeHandler</span>&lt;<span class="title">E</span> <span class="keyword">extends</span> <span class="title">MyObject</span>&gt; <span class="keyword">extends</span> <span class="title">BaseTypeHandler</span>&lt;<span class="title">E</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Class&lt;E&gt; type;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">GenericTypeHandler</span><span class="params">(Class&lt;E&gt; type)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (type == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Type argument cannot be null&quot;</span>);</span><br><span class="line">    <span class="keyword">this</span>.type = type;</span><br><span class="line">  }</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.mybatis.example.ExampleTypeHandler&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;String&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="plugins">plugins</h2>
<p><code>mybatis</code>&#x53EF;&#x5B9A;&#x4E49;&#x63D2;&#x4EF6;&#x6765;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x64CD;&#x4F5C;&#x7684;&#x5404;&#x4E2A;&#x9636;&#x6BB5;&#x4EE5;&#x5207;&#x9762;&#x7684;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;<code>mybatis</code>&#x63D0;&#x4F9B;&#x4E86;&#x56DB;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x63D2;&#x4EF6;</p>
<p>&#x5728;<code>mybatis</code>&#x4E2D;&#x589E;&#x52A0;&#x914D;&#x7F6E;&#xFF0C;<code>&lt;property&gt;</code>&#x7684;&#x503C;&#x6CE8;&#x5165;&#x5230;&#x5177;&#x4F53;&#x63D2;&#x4EF6;&#x7684;<code>setProperties</code>&#x65B9;&#x6CD5;&#x7684;&#x53C2;&#x6570;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;org.mybatis.example.ExamplePlugin&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;someProperty&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&#x63D2;&#x4EF6;&#x9700;&#x8981;&#x7EE7;&#x627F;<code>org.apache.ibatis.plugin.Interceptor</code>&#xFF0C;&#x5176;&#x4E2D;&#x6CE8;&#x89E3;<code>Intercepts</code>&#x7684;&#x503C;&#xFF0C;&#x8868;&#x793A;&#x5207;&#x9762;&#x7684;&#x4F4D;&#x7F6E;</p>
<p><code>type</code> &gt;<code>Executor</code> (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)<br>
&gt;<code>ParameterHandler</code> (getParameterObject, setParameters)<br>
&gt;<code>ResultSetHandler</code> (handleResultSets, handleOutputParameters)<br>
&gt;<code>StatementHandler</code> (prepare, parameterize, batch, update, query)</p>
<p><code>method</code> &gt; <code>type</code>&#x91CC;&#x7684;&#x65B9;&#x6CD5;&#x540D;</p>
<p><code>args</code> &gt; <code>type</code>&#x91CC;&#x7684;&#x65B9;&#x6CD5;&#x7684;&#x53C2;&#x6570;&#x7C7B;&#x578B;</p>
<p><code>metdho</code>&#x548C;<code>args</code>&#x53EF;&#x4EE5;&#x5B9A;&#x4F4D;&#x5230;&#x4E00;&#x4E2A;&#x5177;&#x4F53;&#x7684;<code>java</code>&#x65B9;&#x6CD5;&#x3002;&#x6240;&#x4EE5;<code>method</code>&#x548C;<code>args</code>&#x7684;&#x503C;&#x53C2;&#x8003;<code>type</code>&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x5373;&#x53EF;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.mybatis.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.cache.CacheKey;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.Executor;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.BoundSql;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.MappedStatement;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Interceptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Intercepts;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Invocation;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Signature;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.ResultHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.RowBounds;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Intercepts</span>({</span><br><span class="line">    <span class="meta">@Signature</span>(type = Executor.class, method = <span class="string">&quot;query&quot;</span>, args = {MappedStatement.class, Object.class, RowBounds.class,</span><br><span class="line">        ResultHandler.class, CacheKey.class, BoundSql.class}),</span><br><span class="line">    <span class="meta">@Signature</span>(type = Executor.class, method = <span class="string">&quot;query&quot;</span>, args = {MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class})</span><br><span class="line">})</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExamplePlugin</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable </span>{</span><br><span class="line">        System.out.println(<span class="string">&quot;properties:&quot;</span>+properties);</span><br><span class="line">        <span class="keyword">return</span> invocation.proceed();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.properties = properties;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x901A;&#x8FC7;&#x81EA;&#x5B9A;&#x4E49;&#x63D2;&#x4EF6;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53BB;&#x5206;&#x6790;&#x4E0B; <code>#{}</code>,<code>${}</code>&#x7684;&#x533A;&#x522B;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Intercepts</span>({</span><br><span class="line">    <span class="meta">@Signature</span>(type = Executor.class, method = <span class="string">&quot;query&quot;</span>, args = {MappedStatement.class, Object.class, RowBounds.class,</span><br><span class="line">        ResultHandler.class}),</span><br><span class="line">})</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExamplePlugin</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable </span>{</span><br><span class="line">        MappedStatement mappedStatement = (MappedStatement) invocation.getArgs()[<span class="number">0</span>];</span><br><span class="line">        BoundSql boundSql = mappedStatement.getBoundSql(Map.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;boundSql:&quot;</span> + boundSql.getSql());</span><br><span class="line">        <span class="keyword">return</span> invocation.proceed();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlSession.selectOne(</span><br><span class="line">            <span class="string">&quot;org.mybatis.example.BlogMapper.selectBlog&quot;</span>, <span class="number">1</span> );</span><br></pre></td></tr></table></figure>
<p><code>#{}</code>,<code>${}</code>&#x7684;&#x5B9E;&#x9645;&#x8F93;&#x51FA;&#xFF0C;&#x540E;&#x8005;&#x6709;&#x88AB;<code>sql</code>&#x6CE8;&#x5165;&#x7684;&#x53EF;&#x80FD;&#x6027;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">boundSql:<span class="keyword">select</span> *</span><br><span class="line">    <span class="keyword">from</span> Blog</span><br><span class="line">    <span class="keyword">where</span> <span class="keyword">id</span> = ?</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">boundSql:<span class="keyword">select</span> *</span><br><span class="line">    <span class="keyword">from</span> Blog</span><br><span class="line">    <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h2 id="transactionmanager">transactionManager</h2>
<p>&#x7565;&#xFF0C;&#x4E00;&#x822C;&#x7531;<code>spring</code>&#x53BB;&#x63A7;&#x5236;</p>
<h2 id="environments">environments</h2>
<p>&#x53EF;&#x914D;&#x7F6E;&#x591A;&#x73AF;&#x5883;&#x7684;&#x6570;&#x636E;&#x6E90;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&#x53EF;&#x6307;&#x5B9A;<code>id</code>&#x7684;&#x6570;&#x636E;&#x6E90;&#xFF0C;&#x82E5;&#x672A;&#x6307;&#x5B9A;&#x5219;&#x4F7F;&#x7528;<code>default</code>&#x7684;&#x6570;&#x636E;&#x6E90;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(reader, environment);</span><br><span class="line">SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(reader, environment, properties);</span><br></pre></td></tr></table></figure>
<h2 id="mapping-xml">mapping xml</h2>
<p>&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#x79D1;&#x53C2;&#x8003;<a href="http://www.mybatis.org/mybatis-3/sqlmap-xml.html" target="_blank" rel="noopener">&#x5B98;&#x65B9;&#x6587;&#x6863;</a> <code>mybatis</code>&#x7684;&#x6838;&#x5FC3;&#x5728;&#x4E8E;&#x6620;&#x5C04;&#x7684;<code>SQL</code></p>
<h3 id="select">SELECT</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBlog&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;hashmap&quot;</span> &gt;</span></span><br><span class="line">  select * from Blog where id = #{id}</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>#{id}</code>&#x8FD9;&#x4E2A;&#x901A;&#x77E5;<code>mybatis</code>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>PreparedStatement</code>&#x53C2;&#x6570;&#xFF0C;&#x5728;&#x9884;&#x7F16;&#x8BD1;&#x9636;&#x6BB5;&#x5B9E;&#x9645;<code>sql</code>&#x8BED;&#x53E5;&#x4F1A;&#x88AB;&#x66FF;&#x6362;&#x4E3A; &gt;<code>select * from Blog where id = ?</code></p>
<p>&#x5B9E;&#x9645;&#x6267;&#x884C;&#x4EE3;&#x7801;&#x7C7B;&#x578B;&#x5982;&#x4E0B;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String selectPerson = <span class="string">&quot;SELECT * FROM PERSON WHERE ID=?&quot;</span>;</span><br><span class="line">PreparedStatement ps = conn.prepareStatement(selectPerson);</span><br><span class="line">ps.setInt(<span class="number">1</span>,id);</span><br></pre></td></tr></table></figure>
<p><code>id</code> <code>SQL</code>&#x6620;&#x5C04;&#x552F;&#x4E00;&#x6807;&#x8BC6;<br>
<code>parameterType</code> &#x8BF7;&#x6C42;&#x53C2;&#x6570;<code>class</code>&#x7C7B;&#x578B;<br>
<code>resultType</code> &#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x96C6;&#x7C7B;&#x578B;<br>
<code>resultMap</code> &#x6269;&#x5C55;&#x7684;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x7684;<code>id</code><br>
<code>flushCache</code> &#x662F;&#x5426;&#x6E05;&#x7A7A;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E0D;&#x6E05;&#x7A7A;<br>
<code>useCache</code> &#x662F;&#x5426;&#x5F00;&#x542F;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E0D;&#x7F13;&#x5B58;<br>
<code>timeout</code> &#x8BF7;&#x6C42;&#x8D85;&#x65F6;&#x65F6;&#x95F4;<br>
<code>fetchSize</code> &#x8FD4;&#x56DE;&#x6700;&#x5927;&#x6761;&#x6570;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E0D;&#x9650;&#x5236;<br>
<code>statementType</code> &#x53EF;&#x9009;<code>STATEMENT</code>,<code>PREPARED</code>&#x6216;<code>CALLABLE</code>&#xFF0C;&#x51B3;&#x5B9A;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>Statement</code>,<code>PreparedStatement</code>&#x6216;<code>CallableStatement</code>&#xFF0C;&#x9ED8;&#x8BA4;&#x7684;&#x662F;<code>PREPARED</code><br>
<code>resultSetType</code><br>
<code>databaseId</code> <code>databaseIdProvider</code> &#x591A;&#x79CD;&#x6570;&#x636E;&#x5E93;&#x5F15;&#x64CE;&#x652F;&#x6301;<br>
<code>resultOrdered</code><br>
<code>resultSets</code></p>
<h3 id="insert-update-and-delete">insert, update and delete</h3>
<p><code>id</code> <code>SQL</code>&#x6620;&#x5C04;&#x552F;&#x4E00;&#x6807;&#x8BC6;<br>
<code>parameterType</code> &#x8BF7;&#x6C42;&#x53C2;&#x6570;<code>class</code>&#x7C7B;&#x578B;<br>
<code>flushCache</code> &#x662F;&#x5426;&#x6E05;&#x7A7A;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E0D;&#x6E05;&#x7A7A;<br>
<code>timeout</code> &#x8BF7;&#x6C42;&#x8D85;&#x65F6;&#x65F6;&#x95F4;<br>
<code>statementType</code> &#x53EF;&#x9009;<code>STATEMENT</code>,<code>PREPARED</code>&#x6216;<code>CALLABLE</code>&#xFF0C;&#x51B3;&#x5B9A;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>Statement</code>,<code>PreparedStatement</code>&#x6216;<code>CallableStatement</code>&#xFF0C;&#x9ED8;&#x8BA4;&#x7684;&#x662F;<code>PREPARED</code><br>
<code>useGeneratedKeys</code> &#x662F;&#x5426;&#x4F7F;&#x7528;&#x6570;&#x636E;&#x5E93;&#x81EA;&#x589E;&#x4E3B;&#x952E;<br>
<code>keyProperty</code> &#x7528;&#x4E8E;&#x6307;&#x5B9A;&#x4F20;&#x5165;&#x7684;<code>java</code>&#x6210;&#x5458;&#x53D8;&#x91CF;<br>
<code>keyColumn</code> &#x7528;&#x4E8E;&#x6307;&#x5B9A;&#x6570;&#x636E;&#x5E93;&#x8868;&#x7684;&#x4E3B;&#x952E;&#x5B57;&#x6BB5;<br>
<code>databaseId</code> <code>databaseIdProvider</code> &#x591A;&#x79CD;&#x6570;&#x636E;&#x5E93;&#x5F15;&#x64CE;&#x652F;&#x6301;</p>
<h4 id="&#x8FD4;&#x56DE;&#x4E3B;&#x952E;">&#x8FD4;&#x56DE;&#x4E3B;&#x952E;</h4>
<p>&#x5728;&#x914D;&#x7F6E;&#x4E86;<code>useGeneratedKeys</code>&#x65F6;&#xFF0C;&#x5982;&#x4F55;&#x53D6;&#x5F97;&#x8FD4;&#x56DE;&#x7684;&#x4E3B;&#x952E;</p>
<p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertBlog&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;java_id&quot;</span> <span class="attr">keyColumn</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">  insert into blog( title,author_id) values (#{title},#{author_id})</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">map.put(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;title3&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;author_id&quot;</span>, <span class="string">&quot;102&quot;</span>);</span><br><span class="line"><span class="keyword">int</span> insert = sqlSession.insert(<span class="string">&quot;org.mybatis.example.BlogMapper.insertBlog&quot;</span>, map);</span><br><span class="line">System.out.println(map);</span><br><span class="line">sqlSession.commit();</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>{title=title3, author_id=102, java_id=6}</p>
</blockquote>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD4;&#x56DE;&#x4E3B;&#x952E;&#x5199;&#x5165;&#x5230;&#x8BF7;&#x6C42;&#x7684;<code>pojo</code>&#x4E2D;&#x4E86;</p>
<p><code>mybatis</code>&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x5176;&#x4ED6;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x4E3B;&#x952E;&#x7684;&#x751F;&#x6210;</p>
<p><code>&lt;selectKey&gt;</code> <code>keyProperty</code> &#x6307;&#x5B9A;&#x5B58;&#x50A8;&#x4E3B;&#x952E;&#x7684;&#x5B57;&#x6BB5; <code>keyColumn</code> &#x7528;&#x4E8E;&#x6307;&#x5B9A;&#x6570;&#x636E;&#x5E93;&#x8868;&#x7684;&#x4E3B;&#x952E;&#x5B57;&#x6BB5;<br>
<code>order</code> <code>Before</code>&#x6216;&#x8005;<code>After</code>,&#x82E5;&#x662F;<code>Before</code>,&#x5219;&#x5148;&#x751F;&#x6210;&#x4E3B;&#x952E;&#xFF0C;&#x6267;&#x884C;<code>insert</code>&#x3002;&#x800C;&#x8BBE;&#x7F6E;&#x4E3A;<code>After</code>,&#x5219;&#x5148;<code>insert</code>,&#x518D;&#x8BB2;&#x8FD4;&#x56DE;&#x7684;&#x4E3B;&#x952E;&#x63D2;&#x5165;&#x7684;&#x5199;&#x5165;&#x8BF7;&#x6C42;&#x7684;<code>pojo</code>&#x4E2D;<br>
<code>resultType</code> &#x8FD4;&#x56DE;&#x4E3B;&#x952E;&#x7C7B;&#x578B;<br>
<code>statementType</code> &#x53EF;&#x9009;<code>STATEMENT</code>,<code>PREPARED</code>&#x6216;<code>CALLABLE</code>&#xFF0C;&#x51B3;&#x5B9A;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>Statement</code>,<code>PreparedStatement</code>&#x6216;<code>CallableStatement</code>&#xFF0C;&#x9ED8;&#x8BA4;&#x7684;&#x662F;<code>PREPARED</code></p>
<h4 id="&#x6279;&#x91CF;&#x63D2;&#x5165;">&#x6279;&#x91CF;&#x63D2;&#x5165;</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertBlog&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">   insert into blog( title,author_id) values</span><br><span class="line">   <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">   (#{item.title}, #{item.author_id})</span><br><span class="line">   <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="sql">SQL</h3>
<p>&#x53EF;&#x88AB;&#x5176;&#x4ED6;<code>SQL</code>&#x6620;&#x5C04;&#x8BED;&#x53E5;&#x91CD;&#x590D;&#x4F7F;&#x7528;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;userColumns&quot;</span>&gt;</span> ${alias}.id,${alias}.username,${alias}.password <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;userColumns&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;alias&quot;</span> <span class="attr">value</span>=<span class="string">&quot;t1&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span>,</span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;userColumns&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;alias&quot;</span> <span class="attr">value</span>=<span class="string">&quot;t2&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">  from some_table t1</span><br><span class="line">    cross join some_table t2</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="parameters">Parameters</h3>
<h4 id="&#x6216;"><code>${}</code>&#x6216;<code>#{}</code></h4>
<p><code>${}</code>&#x4F1A;&#x88AB;&#x76F4;&#x63A5;&#x66FF;&#x6362;&#x4E3A;&#x503C;&#xFF0C;&#x800C;<code>#{}</code>&#x5219;&#x8FDB;&#x5165;<code>prepared</code>&#x9636;&#x6BB5;</p>
<p>&#x4F7F;&#x7528;&#x4ECB;&#x7ECD;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select</span>(<span class="string">&quot;select * from user where ${column} = #{value}&quot;</span>)</span><br><span class="line"><span class="function">User <span class="title">findByColumn</span><span class="params">(@Param(<span class="string">&quot;column&quot;</span>)</span> String column, @<span class="title">Param</span><span class="params">(<span class="string">&quot;value&quot;</span>)</span> String value)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="&#x9AD8;&#x9636;"><code>#{}</code>&#x9AD8;&#x9636;</h4>
<blockquote>
<p><code>#{age,javaType=int,jdbcType=NUMERIC,typeHandler=MyTypeHandler}</code></p>
</blockquote>
<p>&#x6307;&#x5B9A;<code>double</code>&#x7684;&#x7CBE;&#x5EA6; &gt;<code>#{height,javaType=double,jdbcType=NUMERIC,numericScale=2}</code></p>
<h3 id="resultmap">ResultMap</h3>
<p>&#x901A;&#x8FC7;&#x81EA;&#x5B9A;&#x4E49;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#x6765;&#x5904;&#x7406;&#x590D;&#x6742;&#x7684;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x96C6;</p>
<p>&#x5C5E;&#x6027; <code>id</code> &#x4E3B;&#x952E; <code>type</code> &#x8FD4;&#x56DE;<code>class</code>&#x7C7B;&#x578B; <code>autoMapping</code> &#x81EA;&#x52A8;&#x5339;&#x914D;&#x7684;&#x6A21;&#x5F0F;&#x3002;&#x67E5;&#x8BE2;&#x7684;<code>ResultSet</code>&#x8F6C;&#x6362;<code>pojo</code>&#x65F6;&#xFF0C;&#x4F1A;&#x81EA;&#x52A8;&#x67E5;&#x627E;&#x540C;&#x540D;&#x5C5E;&#x6027;(&#x5FFD;&#x7565;&#x5927;&#x5C0F;&#x5199;) &gt;<code>NONE</code>&#x8868;&#x793A;&#x4E0D;&#x542F;&#x7528;&#x81EA;&#x52A8;&#x6620;&#x5C04; &gt;<code>PARTIAL</code>&#x8868;&#x793A;&#x53EA;&#x5BF9;&#x975E;&#x5D4C;&#x5957;&#x7684;resultMap&#x8FDB;&#x884C;&#x81EA;&#x52A8;&#x6620;&#x5C04; &gt;<code>FULL</code>&#x8868;&#x793A;&#x5BF9;&#x6240;&#x6709;&#x7684;resultMap&#x90FD;&#x8FDB;&#x884C;&#x81EA;&#x52A8;&#x6620;&#x5C04;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;detailedBlogResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">idArg</span> <span class="attr">column</span>=<span class="string">&quot;blog_id&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;int&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">constructor</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;title&quot;</span> <span class="attr">column</span>=<span class="string">&quot;blog_title&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;author&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;Author&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;author_id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span> <span class="attr">column</span>=<span class="string">&quot;author_username&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span> <span class="attr">column</span>=<span class="string">&quot;author_password&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;author_email&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;bio&quot;</span> <span class="attr">column</span>=<span class="string">&quot;author_bio&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;favouriteSection&quot;</span> <span class="attr">column</span>=<span class="string">&quot;author_favourite_section&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;posts&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;post_id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;subject&quot;</span> <span class="attr">column</span>=<span class="string">&quot;post_subject&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;author&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;Author&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;comments&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Comment&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;comment_id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;tags&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Tag&quot;</span> &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tag_id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">discriminator</span> <span class="attr">javaType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">column</span>=<span class="string">&quot;draft&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;DraftPost&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">discriminator</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="id-result">id &amp; result</h4>
<p>&#x6620;&#x5C04;&#x57FA;&#x672C;&#x7C7B;&#x578B;&#xFF0C;<code>id</code>&#x8868;&#x793A;&#x4E3B;&#x952E;<br>
&gt;<code>property</code> <code>pojo</code>&#x6210;&#x5458;&#x53D8;&#x91CF;<br>
&gt;<code>column</code> &#x6570;&#x636E;&#x5E93;&#x5B57;&#x6BB5;<br>
&gt;<code>javaType</code> &#x6210;&#x5458;&#x53D8;&#x91CF;<code>class</code>&#x7C7B;&#x578B;<br>
&gt;<code>jdbcType</code> &#x6570;&#x636E;&#x5E93;&#x5B57;&#x6BB5;&#x7C7B;&#x578B;<br>
&gt;<code>typeHandler</code> &#x4F7F;&#x7528;&#x5177;&#x4F53;&#x7684;&#x5904;&#x7406;&#x5668;&#x53BB;&#x5904;&#x7406;</p>
<p>&#x652F;&#x6301;&#x7684;&#x6570;&#x636E;&#x5E93;&#x7C7B;&#x578B; &gt;<code>BIT</code> <code>FLOAT</code> <code>CHAR</code> <code>TIMESTAMP</code> <code>OTHER</code> <code>UNDEFINED</code> &gt;<code>TINYINT</code> <code>REAL</code> <code>VARCHAR</code> <code>BINARY</code> <code>BLOB</code> <code>NVARCHAR</code> &gt;<code>SMALLINT</code> <code>DOUBLE</code> <code>LONGVARCHAR</code> <code>VARBINARY</code> <code>CLOB</code> <code>NCHAR</code> &gt;<code>INTEGER</code> <code>NUMERIC</code> <code>DATE</code> <code>LONGVARBINARY</code> <code>BOOLEAN</code> <code>NCLOB</code> &gt;<code>BIGINT</code> <code>DECIMAL</code> <code>TIME</code> <code>NULL</code> <code>CURSOR</code> <code>ARRAY</code></p>
<h4 id="constructor">constructor</h4>
<p>&#x4E3A;<code>type</code>&#x6709;&#x53C2;&#x6784;&#x9020;&#x5668;&#x4F20;&#x9012;&#x53C2;&#x6570;&#xFF0C;&#x5206;&#x4E3A;<code>&lt;idArg&gt;</code>&#xFF08;&#x4E3B;&#x952E;&#xFF09;&#x548C;<code>&lt;arg&gt;</code>&#xFF0C;&#x9ED8;&#x8BA4;&#x6784;&#x9020;&#x5668;&#x53C2;&#x6570;&#x6839;&#x636E;&#x987A;&#x5E8F;&#x8FDB;&#x884C;&#x4F20;&#x53C2;&#x3002; &gt;<code>property</code> <code>pojo</code>&#x6210;&#x5458;&#x53D8;&#x91CF;<br>
&gt;<code>column</code> &#x6570;&#x636E;&#x5E93;&#x5B57;&#x6BB5;<br>
&gt;<code>javaType</code> &#x6210;&#x5458;&#x53D8;&#x91CF;<code>class</code>&#x7C7B;&#x578B;<br>
&gt;<code>jdbcType</code> &#x6570;&#x636E;&#x5E93;&#x5B57;&#x6BB5;&#x7C7B;&#x578B;<br>
&gt;<code>typeHandler</code> &#x4F7F;&#x7528;&#x5177;&#x4F53;&#x7684;&#x5904;&#x7406;&#x5668;&#x53BB;&#x5904;&#x7406; &gt;<code>select</code> &#x5176;&#x4ED6;&#x6620;&#x5C04;&#x8BED;&#x53E5;&#x7684;id&#xFF0C;&#x6839;&#x636E;&#x5176;&#x67E5;&#x8BE2;&#x503C;&#x6CE8;&#x5165;&#x6784;&#x9020;&#x5668;&#x53C2;&#x6570;&#x4E2D; &gt;<code>resultMap</code> &#x5F15;&#x5165;&#x5176;&#x4ED6;<code>resultMap</code> &gt; <code>name</code> &#x6839;&#x636E;&#x540D;&#x79F0;&#x6307;&#x5B9A;&#x5177;&#x4F53;&#x53C2;&#x6570;&#x503C;&#xFF0C;&#x65E0;&#x89C6;&#x53C2;&#x6570;&#x987A;&#x5E8F;&#x3002;</p>
<h4 id="association">association</h4>
<p>&#x4E00;&#x5B9A;&#x8981;&#x6CE8;&#x610F;&#x96C6;&#x5408;&#x7C7B;&#x578B;&#x7684;&#x957F;&#x5EA6;</p>
<blockquote>
<p><code>property</code> <code>pojo</code>&#x6210;&#x5458;&#x53D8;&#x91CF;<br>
<code>column</code> &#x6570;&#x636E;&#x5E93;&#x5B57;&#x6BB5;<br>
<code>javaType</code> &#x6210;&#x5458;&#x53D8;&#x91CF;<code>class</code>&#x7C7B;&#x578B;<br>
<code>jdbcType</code> &#x6570;&#x636E;&#x5E93;&#x5B57;&#x6BB5;&#x7C7B;&#x578B;<br>
<code>typeHandler</code> &#x4F7F;&#x7528;&#x5177;&#x4F53;&#x7684;&#x5904;&#x7406;&#x5668;&#x53BB;&#x5904;&#x7406; <code>select</code> &#x5176;&#x4ED6;&#x6620;&#x5C04;&#x8BED;&#x53E5;&#x7684;id&#xFF0C;&#x6839;&#x636E;&#x5176;&#x67E5;&#x8BE2;&#x503C;&#x6CE8;&#x5165;&#x5230;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x4E2D; <code>resultMap</code> &#x5F15;&#x5165;&#x5176;&#x4ED6;<code>resultMap</code> <code>fetchType</code> &#x53EF;&#x8BBE;&#x7F6E;&#x4E3A;<code>lazy</code>&#x6216;<code>eager</code>&#x662F;&#x5426;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D; <code>columnPrefix</code> &#x5F53;&#x6D89;&#x53CA;&#x5230;&#x591A;&#x8868;&#x67E5;&#x8BE2;&#x65F6;&#xFF0C;&#x591A;&#x8868;&#x7684;&#x5B57;&#x6BB5;&#x76F8;&#x540C;&#xFF0C;&#x90A3;&#x4E48;<code>sql</code>&#x8BED;&#x53E5;&#x5C31;&#x9700;&#x8981;&#x4F7F;&#x7528;<code>as</code>&#x6765;&#x533A;&#x5206;&#x5B57;&#x6BB5;&#x3002; &#x4F8B;&#x5982;&#xFF1A;</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBlog&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;blogResult&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">  B.id as blog_id,</span><br><span class="line">  B.title as blog_title,</span><br><span class="line">  B.author_id as blog_author_id,</span><br><span class="line">  P.id as post_id,</span><br><span class="line">  P.subject as post_subject,</span><br><span class="line">  P.body as post_body,</span><br><span class="line">  from Blog B</span><br><span class="line">  left outer join Post P on B.id = P.blog_id</span><br><span class="line">  where B.id = #{id}</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#x6211;&#x4EEC;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;blogResult&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;blog_id&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;title&quot;</span> <span class="attr">column</span>=<span class="string">&quot;blog_title&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;posts&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;post_id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;subject&quot;</span> <span class="attr">column</span>=<span class="string">&quot;post_subject&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;body&quot;</span> <span class="attr">column</span>=<span class="string">&quot;post_body&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>columnPrefix</code>&#x6765;&#x5904;&#x7406;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;blogResult&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;blog_id&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;title&quot;</span> <span class="attr">column</span>=<span class="string">&quot;blog_title&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;posts&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Post&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;blogPostResult&quot;</span> <span class="attr">columnPrefix</span>=<span class="string">&quot;post_&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;blogPostResult&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Post&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;subject&quot;</span> <span class="attr">column</span>=<span class="string">&quot;subject&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;body&quot;</span> <span class="attr">column</span>=<span class="string">&quot;body&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="discriminator">discriminator</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;vehicleResult&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Vehicle&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;vin&quot;</span> <span class="attr">column</span>=<span class="string">&quot;vin&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;year&quot;</span> <span class="attr">column</span>=<span class="string">&quot;year&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;make&quot;</span> <span class="attr">column</span>=<span class="string">&quot;make&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;model&quot;</span> <span class="attr">column</span>=<span class="string">&quot;model&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;color&quot;</span> <span class="attr">column</span>=<span class="string">&quot;color&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">discriminator</span> <span class="attr">javaType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">column</span>=<span class="string">&quot;vehicle_type&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;carResult&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;truckResult&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;vanResult&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">&quot;4&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;suvResult&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">discriminator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&#x6839;&#x636E;<code>column</code>&#x7684;&#x503C;&#x51B3;&#x5B9A;&#x54EA;&#x79CD;<code>&lt;case&gt;</code>&#x6267;&#x884C;</p>
<h3 id="cache">cache</h3>
<p>&#x7565;&#x8FC7;&#xFF0C;&#x7531;<code>spring</code>&#x53BB;&#x63A7;&#x5236;</p>
<h2 id="dynamic-sql">Dynamic SQL</h2>
<h2 id="springboot">SpringBoot</h2>
<p>maven&#x4F9D;&#x8D56;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><a href="http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/" target="_blank" rel="noopener">&#x5B98;&#x65B9;&#x6587;&#x6863;</a></p>
<p>&#x53EF;&#x5728;<code>springboot</code>&#x914D;&#x7F6E;&#x6587;&#x4EF6;<code>application.properties</code>(&#x6216;<code>application.yml</code>).&#x4E2D;&#x914D;&#x7F6E;<code>Mybatis</code>&#x4F7F;&#x7528;<code>mybatis</code>&#x524D;&#x7F00;&#x4F5C;&#x4E3A;&#x914D;&#x7F6E;</p>
<p><code>config-location</code> <code>mybatis</code>&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x76EE;&#x5F55; <code>mapper-locations</code> <code>mapper</code>&#x6587;&#x4EF6;&#x76EE;&#x5F55;&#x5730;&#x5740; <code>type-aliases-package</code> &#x522B;&#x540D;&#x5305;&#x540D;&#xFF0C;&#x4E0D;&#x540C;&#x76EE;&#x5F55;&#x53EF;&#x7528;<code>,; \t\n</code>&#x5206;&#x5272; <code>type-handlers-package</code> &#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x5668;&#x5305;&#x540D;&#xFF0C;&#x4E0D;&#x540C;&#x76EE;&#x5F55;&#x53EF;&#x7528;<code>,; \t\n</code>&#x5206;&#x5272; <code>configuration-properties</code> &#x6307;&#x5B9A;<code>properties</code>&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x53EF;&#x88AB;<code>mybatis</code>&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x548C;<code>mapper</code>&#x6587;&#x4EF6;&#x4E2D;&#x4F5C;&#x4E3A;&#x5360;&#x4F4D;&#x7B26;&#x4F7F;&#x7528; <code>configuration.*</code> &#x7B49;&#x540C;&#x4E8E;<code>mybatis</code>&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x7684;<code>settings</code></p>
<p>&#x53EF;&#x4F7F;&#x7528;<code>ConfigurationCustomizer</code>&#x6765;&#x81EA;&#x5B9A;&#x5236;&#x7EC6;&#x8282;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisConfig</span> </span>{</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function">ConfigurationCustomizer <span class="title">mybatisConfigurationCustomizer</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ConfigurationCustomizer() {</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(Configuration configuration)</span> </span>{</span><br><span class="line">        <span class="comment">// customize ...</span></span><br><span class="line">      }</span><br><span class="line">    };</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><code>mybatis</code>&#x4F1A;&#x81EA;&#x52A8;&#x68C0;&#x6D4B;&#x7EE7;&#x627F;<code>mybatis</code>&#x63A5;&#x53E3;&#x7684;<code>bean</code><br>
<code>Interceptor</code><br>
<code>TypeHandler</code><br>
<code>LanguageDriver (Requires to use together with mybatis-spring 2.0.2+)</code><br>
<code>DatabaseIdProvider</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisConfig</span> </span>{</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function">MyInterceptor <span class="title">myInterceptor</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> MyInterceptor();</span><br><span class="line">  }</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function">MyTypeHandler <span class="title">myTypeHandler</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> MyTypeHandler();</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://leaderli.github.io/2019/07/31/动态规划/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lijun">
      <meta itemprop="description" content="与其感慨路难行，不如马上就出发">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大狗哥传奇">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/31/动态规划/" class="post-title-link" itemprop="url">动态规划</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-31 20:28:41" itemprop="dateCreated datePublished" datetime="2019-07-31T20:28:41+08:00">2019-07-31</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-01 22:46:03" itemprop="dateModified" datetime="2019-08-01T22:46:03+08:00">2019-08-01</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/算法/" itemprop="url" rel="index"><span itemprop="name">算法</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css" integrity="sha384-dbVIfZGuN1Yq7/1Ocstc1lUEm+AT+/rCkibIcC/OmWo5f0EA48Vf8CytHzGrSwbQ" crossorigin="anonymous"><h2 id="&#x9898;&#x76EE;">&#x9898;&#x76EE;</h2>
<p>&#x5047;&#x8BBE;&#x4F60;&#x6B63;&#x5728;&#x722C;&#x697C;&#x68AF;&#x3002;&#x9700;&#x8981; n&#xA0;&#x9636;&#x4F60;&#x624D;&#x80FD;&#x5230;&#x8FBE;&#x697C;&#x9876;&#x3002; &#x6BCF;&#x6B21;&#x4F60;&#x53EF;&#x4EE5;&#x722C; 1 &#x6216; 2 &#x4E2A;&#x53F0;&#x9636;&#x3002;&#x4F60;&#x6709;&#x591A;&#x5C11;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x722C;&#x5230;&#x697C;&#x9876;&#x5462;&#xFF1F; &#x6CE8;&#x610F;&#xFF1A;&#x7ED9;&#x5B9A; n &#x662F;&#x4E00;&#x4E2A;&#x6B63;&#x6574;&#x6570;&#x3002;</p>
<p>&#x793A;&#x4F8B; 1&#xFF1A; &gt;&#x8F93;&#x5165;&#xFF1A; 2 &#x8F93;&#x51FA;&#xFF1A; 2</p>
<p>&#x89E3;&#x91CA;&#xFF1A; &#x6709;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x722C;&#x5230;&#x697C;&#x9876;&#x3002;</p>
<blockquote>
<p>1 &#x9636; + 1 &#x9636; 2 &#x9636;</p>
</blockquote>
<p>&#x793A;&#x4F8B; 2&#xFF1A; &gt;&#x8F93;&#x5165;&#xFF1A; 3 &#x8F93;&#x51FA;&#xFF1A; 3</p>
<p>&#x89E3;&#x91CA;&#xFF1A; &#x6709;&#x4E09;&#x79CD;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x722C;&#x5230;&#x697C;&#x9876;&#x3002;</p>
<blockquote>
<p>1 &#x9636; + 1 &#x9636; + 1 &#x9636; 1 &#x9636; + 2 &#x9636; 2 &#x9636; + 1 &#x9636;</p>
</blockquote>
<h2 id="&#x601D;&#x8DEF;">&#x601D;&#x8DEF;</h2>
<p>&#x4F7F;&#x7528;&#x52A8;&#x6001;&#x89C4;&#x5212;&#x7684;&#x601D;&#x8DEF;&#x53BB;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x3002;&#x5BF9;&#x4E8E;&#x6307;&#x5B9A;n&#x9636;&#x7684;&#x697C;&#x68AF;&#xFF0C;&#x6700;&#x540E;&#x4E00;&#x6B21;&#x722C;&#x697C;&#x68AF;&#xFF0C;&#x8981;&#x561B;&#x662F;1&#x9636;&#xFF0C;&#x8981;&#x561B;&#x5C31;&#x662F;2&#x9636;&#xFF0C;&#x90A3;&#x4E48;&#x603B;&#x5171;&#x5C31;&#x6709;&#x722C;<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>&#x2212;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>&#x9636;&#x548C;<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>&#x2212;</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">n-2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span>&#x9636;&#x7684;&#x697C;&#x68AF;</p>
<p>&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;&#x5F0F;</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">F(1) = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi><mo stretchy="false">(</mo><mn>2</mn><mo stretchy="false">)</mo><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">F(2) = 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mi>F</mi><mo stretchy="false">(</mo><mi>n</mi><mo>&#x2212;</mo><mn>1</mn><mo stretchy="false">)</mo><mo>+</mo><mi>F</mi><mo stretchy="false">(</mo><mi>n</mi><mo>&#x2212;</mo><mn>2</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">F(n) = F(n-1)+F(n-2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span></span></span></span></p>
<p>&#x6839;&#x636E;&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;&#x5F0F;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F88;&#x5BB9;&#x6613;&#x7684;&#x5F97;&#x51FA;&#x4EE3;&#x7801;&#x5982;&#x4E0B;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">climbStairs</span><span class="params">(<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">3</span>) {</span><br><span class="line">      <span class="keyword">return</span> n;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> f1 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> f2 = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">3</span>; i &lt;=n; i++) {</span><br><span class="line">      <span class="keyword">int</span> t = f2;</span><br><span class="line">      f2 = f2 + f1;</span><br><span class="line">      f1 = t;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> f2;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://leaderli.github.io/2019/07/30/springboot-jpa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lijun">
      <meta itemprop="description" content="与其感慨路难行，不如马上就出发">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大狗哥传奇">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/30/springboot-jpa/" class="post-title-link" itemprop="url">springboot-jpa</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-30 21:50:50" itemprop="dateCreated datePublished" datetime="2019-07-30T21:50:50+08:00">2019-07-30</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-01 21:54:01" itemprop="dateModified" datetime="2019-08-01T21:54:01+08:00">2019-08-01</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/springboot/" itemprop="url" rel="index"><span itemprop="name">springboot</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="&#x7248;&#x672C;&#x8BF4;&#x660E;">&#x7248;&#x672C;&#x8BF4;&#x660E;</h2>
<p><code>jdk</code>:1.8.0_131 <code>springboot</code>:2.1.6.RELEAS <code>maven</code>:3.6.1 <code>database</code>:mysql-5.7.14 <code>lombok&#x63D2;&#x4EF6;</code></p>
<h2 id="&#x6982;&#x8FF0;">&#x6982;&#x8FF0;</h2>
<p>&#x9879;&#x76EE;&#x57FA;&#x4E8E;maven&#xFF0C;pom&#x914D;&#x7F6E;&#x5982;&#x4E0B;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.li<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>springboot<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.ulisesbocchio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jasypt-spring-boot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.inject<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.inject<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-clean-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&#x90E8;&#x5206;&#x4EE3;&#x7801;&#x4F7F;&#x7528;<code>lombok</code>&#x8FDB;&#x884C;&#x7B80;&#x5316;</p>
<p>&#x8868;&#x5B9E;&#x4F53;&#x7C7B;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.li.springboot.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Proxy</span>(lazy = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@Entity</span>(name = <span class="string">&quot;log&quot;</span>)</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Log</span> </span>{</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String log;</span><br><span class="line">    <span class="keyword">private</span> String time;</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">&quot;user_id&quot;</span>)</span><br><span class="line">    <span class="keyword">private</span> String userID;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><code>@Id</code>&#x8868;&#x793A;&#x4E3B;&#x952E; <code>@Entity</code>&#x6807;&#x8BB0;&#x5F53;&#x524D;&#x7C7B;&#x4E3A;&#x4E00;&#x4E2A;&#x8868;&#xFF0C;&#x82E5;&#x6307;&#x5B9A;&#x5C5E;&#x6027;<code>name</code>&#xFF0C;&#x5219;&#x5B9E;&#x9645;&#x8868;&#x540D;&#x4F7F;&#x7528;<code>name</code>&#x7684;&#x503C;&#xFF0C;&#x5426;&#x5219;&#x4F7F;&#x7528;&#x7C7B;&#x540D;&#x3002; <code>@Column</code>&#x4E2D;&#x7684;<code>name</code>&#x540C;&#x6837;&#x4E5F;&#x662F;&#x6307;&#x5B9A;&#x8868;&#x7684;&#x5B57;&#x6BB5;&#x540D;&#x3002;</p>
<p>&#x8868;&#x64CD;&#x4F5C;&#x7C7B;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.li.springboot.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.li.springboot.bean.Log;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LogDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Log</span>, <span class="title">String</span>&gt; </span>{</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.li.springboot.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.li.springboot.bean.Log;</span><br><span class="line"><span class="keyword">import</span> com.li.springboot.dao.LogDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogController</span> </span>{</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  LogDao logDao;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping</span>(<span class="string">&quot;/{id}&quot;</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Log <span class="title">log</span><span class="params">(@PathVariable String id)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> logDao.getOne(id);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><code>JpaRepository</code>&#x7684;&#x6CDB;&#x578B;&#xFF0C;&#x5206;&#x522B;&#x6307;&#x5B9A;&#x8868;&#x5B9E;&#x4F53;&#x7C7B;&#x548C;&#x8868;&#x4E3B;&#x952E;,<code>JpaRepository</code>&#x5305;&#x542B;&#x5E38;&#x7528;&#x7684;&#x6570;&#x636E;&#x5E93;&#x64CD;&#x4F5C;&#xFF0C;<code>LogDao</code>&#x53EF;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x3002;</p>
<p>&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x4FE1;&#x606F;&#x914D;&#x7F6E;</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://localhost:3306/app</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">&apos;{cipher}cm9vdA&apos;</span></span><br><span class="line"><span class="attr">    driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">  jpa:</span></span><br><span class="line"><span class="attr">    show-sql:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line"><span class="attr">  level:</span></span><br><span class="line"><span class="attr">    root:</span> <span class="string">error</span></span><br><span class="line"><span class="attr">    com:</span></span><br><span class="line"><span class="attr">      li:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure>
<p>&#x5176;&#x4ED6;&#xFF0C;&#x7565;</p>
<p>&#x6D4B;&#x8BD5;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.li.springboot.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line"><span class="keyword">import</span> com.li.springboot.bean.Log;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.MockMvc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogControllerTest</span> </span>{</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        mockMvc.perform(get(<span class="string">&quot;/1&quot;</span>)).andDo(print()).andExpect(result -&gt; {</span><br><span class="line">            Log log = <span class="keyword">new</span> Gson().fromJson(result.getResponse().getContentAsString(), Log.class);</span><br><span class="line">            <span class="keyword">assert</span> log !=<span class="keyword">null</span>;</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">lijun</p>
              <div class="site-description motion-element" itemprop="description">与其感慨路难行，不如马上就出发</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">55</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">31</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">79</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lijun</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/affix.js?v=7.2.0"></script>

  <script src="/js/schemes/pisces.js?v=7.2.0"></script>



  

  


  <script src="/js/next-boot.js?v=7.2.0"></script>


  

  

  

  



  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.json";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  

  

  

  

  

  

  

  


   <!-- 代码块复制功能 -->
  <script type="text/javascript" src="/js/src/clipboard.min.js"></script>  
  <script type="text/javascript" src="/js/src/clipboard-use.js"></script>
</body>
</html>
